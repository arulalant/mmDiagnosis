<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>psutils &mdash; mmDiagnosis 1a documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="mmDiagnosis 1a documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">mmDiagnosis 1a documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for psutils</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">cdms2</span>
<span class="kn">import</span> <span class="nn">cdtime</span>
<span class="kn">import</span> <span class="nn">cdutil</span>
<span class="kn">from</span> <span class="nn">numpy.fft.fftpack</span> <span class="kn">import</span> <span class="n">fftpack</span>
<span class="c">#import numarray.fft.fftpack as fftpack</span>

<span class="c"># setting the absolute path of the previous directory</span>
<span class="c"># getting the this py module path by __file__ variable</span>
<span class="c"># pass that __file__ to the os.path.dirname, returns the path of this module</span>
<span class="n">__curDir__</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">diagDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">__curDir__</span><span class="p">,</span> <span class="s">&#39;../../..&#39;</span><span class="p">))</span>
<span class="c"># adding the previous diagnosisutils path to python path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diagDir</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">diagnosisutils.timeutils</span> <span class="kn">import</span> <span class="n">TimeUtility</span>
<span class="kn">import</span> <span class="nn">diag_setup.netcdf_settings</span>


<span class="c"># create time utility object</span>
<span class="n">timobj</span> <span class="o">=</span> <span class="n">TimeUtility</span><span class="p">()</span>


<div class="viewcode-block" id="powerSpectrum"><a class="viewcode-back" href="../mjo.html#psutils.powerSpectrum">[docs]</a><span class="k">def</span> <span class="nf">powerSpectrum</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    varName - variable</span>
<span class="sd">    fpath or data :</span>
<span class="sd">           This anomaly data should not be spatial one. It should be spatially</span>
<span class="sd">           averaged, daily data.</span>
<span class="sd">           It may contains many years data with proper time axis.</span>

<span class="sd">    nodays : No of days. though its averaged data, pass the no of days of the</span>
<span class="sd">             data of each year which has averaged.</span>
<span class="sd">             For 180 days summer/winter season averaged of multi-year data,</span>
<span class="sd">             you have to pass nodays=180.</span>

<span class="sd">    Written By : Arulalan.T</span>

<span class="sd">    Date : 31.10.2012</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#timeAxis = data.getTime()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">timeAxis</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
    <span class="n">comptime</span> <span class="o">=</span> <span class="n">timeAxis</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()</span>
    <span class="n">avlyears</span> <span class="o">=</span> <span class="n">timobj</span><span class="o">.</span><span class="n">_getYears</span><span class="p">(</span><span class="n">timeAxis</span><span class="p">,</span> <span class="n">deepsearch</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">avlyears</span><span class="p">:</span>
                <span class="n">avlyears</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Passed year </span><span class="si">%d</span><span class="s"> is not available&quot;</span> <span class="o">%</span> <span class="n">year</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">syearIdx</span> <span class="o">=</span> <span class="n">avlyears</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">eyearIdx</span> <span class="o">=</span> <span class="n">avlyears</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">avlyears</span> <span class="o">=</span> <span class="n">avlyears</span><span class="p">[</span><span class="n">syearIdx</span><span class="p">:</span> <span class="n">eyearIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c"># end of if year:</span>

    <span class="c"># check if smon &gt; emon or (smon == emon and sday &gt;= eday):</span>
    <span class="c"># if end day and end month is lower than the start day and start</span>
    <span class="c"># month, then we need to extract the both current and next year</span>
    <span class="c"># data. For eg : Winter Season (November to April).</span>
    <span class="c"># It can not be reversed for this winter season. We need to</span>
    <span class="c"># extract data from current year november month upto next year</span>
    <span class="c"># march month.</span>
    <span class="c">#</span>
    <span class="n">scomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">sday</span><span class="p">)</span>
    <span class="n">ecomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">eday</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ecomp</span><span class="o">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">scomp</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c"># satisfied if smon &gt; emon or (smon == emon and sday &gt;= eday):</span>
        <span class="c"># The end day and end month is lower than the start day and start</span>
        <span class="c"># month.</span>
        <span class="c"># increase one year to the enddate to extract the next year data.</span>
        <span class="n">adjyear</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c"># increase one year to the enddate comptime</span>
        <span class="n">ecomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">eday</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># satisfied smon &lt; emon</span>
        <span class="n">adjyear</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># end of if ecomp.cmp(scomp) == -1:</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">nodays</span><span class="p">:</span>
        <span class="c"># get the no of days between the start and end of the season.</span>
        <span class="n">nodays</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ecomp</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s">&#39;days since </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">scomp</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="c"># end of if not nodays:</span>

    <span class="c"># no of coefficients to be genearated</span>
    <span class="n">nocoef</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">nodays</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="c"># function rffti initializes the array wsave which is used in rfftf.</span>
    <span class="c"># nodays must be int, not float to calculate rffti. !!!</span>
    <span class="n">wsave</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">rffti</span><span class="p">(</span><span class="n">nodays</span><span class="p">)</span>
    <span class="c"># Averaged variance initalized.</span>
    <span class="n">total_variance</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nocoef</span><span class="p">)</span>
    <span class="n">totalYears</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">avlyears</span><span class="p">:</span>
        <span class="c"># loop through available years of the data</span>
        <span class="c"># genearate the start of the current year (season)</span>
        <span class="n">sdate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Start&quot;</span><span class="p">,</span> <span class="n">sdate</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sdate</span> <span class="ow">in</span> <span class="n">comptime</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sdate</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; is not available in the model data time&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;So selecting which ever is available in the passed season&quot;</span>

        <span class="c"># adjust the year (nextyear) to get the end season year to extract</span>
        <span class="c"># the season data correctly in both winter/summer seasons.</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="n">adjyear</span>

        <span class="c"># generate the end date either for current year or next year.</span>
        <span class="n">edate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>
        <span class="c"># initializes the segmantData size with dummy array</span>
        <span class="n">segmantData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nodays</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># extract the season data from file object</span>
            <span class="n">seasonalData</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">sdate</span><span class="p">,</span> <span class="n">edate</span><span class="p">),</span> <span class="n">squeeze</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c">#seasonalData = data(time=(sdate, edate))</span>
        <span class="k">except</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">CDMSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Couldnt extracted seasonalData successfully for the year&quot;</span><span class="p">,</span> <span class="n">year</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s">&quot;So Skipping without extracting data&quot;</span>
            <span class="k">continue</span>
        <span class="c"># end of try:</span>
        <span class="k">print</span> <span class="s">&quot;Extracted seasonalData successfully for the year&quot;</span><span class="p">,</span> <span class="n">year</span>

        <span class="n">segmantData</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">seasonalData</span><span class="p">)]</span> <span class="o">=</span> <span class="n">seasonalData</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nodays</span><span class="p">]</span><span class="c">#?</span>

        <span class="c"># make memory free</span>
        <span class="k">del</span> <span class="n">seasonalData</span>
        <span class="c"># increament the no of years (only successfully extracted data !)</span>
        <span class="n">totalYears</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># length of signal to be transformed</span>
        <span class="c">#nodays = len(seasonalData)  ## ???</span>

<span class="c">#        # totvar = sum of all variance</span>
<span class="c">#        totvar = 0</span>

        <span class="c"># computes the fourier coefficients</span>
        <span class="n">coeff_var</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">rfftf</span><span class="p">(</span><span class="n">segmantData</span><span class="p">,</span> <span class="n">wsave</span><span class="p">)</span>
        <span class="c"># get the real &amp; imaginary parts of the fourier coefficients</span>
        <span class="n">coef1</span> <span class="o">=</span> <span class="n">coeff_var</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">nocoef</span>
        <span class="n">coef2</span> <span class="o">=</span> <span class="n">coeff_var</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="n">nocoef</span>

        <span class="c">#variance = numpy.zeros(nocoef)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="p">(</span><span class="n">coef1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">coef2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>

        <span class="n">nocoef</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nocoef</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodays</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># even days</span>
            <span class="n">variance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">coef1</span><span class="p">[</span><span class="n">nocoef</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">coef2</span><span class="p">[</span><span class="n">nocoef</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># odd days</span>
            <span class="n">variance</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">coef1</span><span class="p">[</span><span class="n">nocoef</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">coef2</span><span class="p">[</span><span class="n">nocoef</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="c"># end of if nodays % 2 == 0:</span>

        <span class="n">total_variance</span> <span class="o">+=</span> <span class="n">variance</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   <span class="c"># ? got 1 extra dimension in rfftf function</span>

    <span class="c"># end of for year in avlyears:</span>

    <span class="c"># finally got the averaged variances over the no of years</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">total_variance</span> <span class="o">/</span> <span class="n">totalYears</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;power&#39;</span><span class="p">)</span>
    <span class="c"># total of averaged variance</span>
    <span class="n">total_variance_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">total_variance</span><span class="p">)</span>
    <span class="c"># calculate the frequency</span>
    <span class="n">frequency</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nocoef</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nodays</span><span class="p">)</span>
    <span class="n">frequency</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;frequency&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">power</span><span class="p">,</span> <span class="n">frequency</span>
<span class="c"># end of def powerSpectrum(data, sday, smon, eday, emon, hr=0):</span>

</div>
<span class="k">def</span> <span class="nf">summerPowerSpectrum</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">eday</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">emon</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">powerSpectrum</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
<span class="c"># end of def summerPowerSpectrum(...):</span>


<span class="k">def</span> <span class="nf">winterPowerSpectrum</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">eday</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">emon</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">powerSpectrum</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
<span class="c"># end of def winterPowerSpectrum(...):</span>


<div class="viewcode-block" id="waveNumber"><a class="viewcode-back" href="../mjo.html#psutils.waveNumber">[docs]</a><span class="k">def</span> <span class="nf">waveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    varName - variable</span>
<span class="sd">    fpath or data :</span>
<span class="sd">           This anomaly data should be meridionally averaged one.</span>
<span class="sd">           It should be daily data.</span>
<span class="sd">           It may contains many years data with proper time axis.</span>

<span class="sd">    KWArgs :-</span>
<span class="sd">    nodays : No of days. though its averaged data, pass the no of days of the</span>
<span class="sd">             data of each year which has averaged.</span>
<span class="sd">             For 180 days summer/winter season averaged of multi-year data,</span>
<span class="sd">             you have to pass nodays=180.</span>

<span class="sd">    window : do cosine window if True</span>

<span class="sd">    iglimit : ignore newlon_limit days. By default it takes 10 days.</span>
<span class="sd">              i.e. If extracted season data is less than the (actual seasonal</span>
<span class="sd">              days - iglimit) it will throw an error.</span>

<span class="sd">    Date : 28.11.2012, 02.12.2012</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nodays</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nodays&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;window&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">iglimit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;iglimit&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c">#timeAxis = data.getTime()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">timeAxis</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
    <span class="n">comptime</span> <span class="o">=</span> <span class="n">timeAxis</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()</span>
    <span class="n">avlyears</span> <span class="o">=</span> <span class="n">timobj</span><span class="o">.</span><span class="n">_getYears</span><span class="p">(</span><span class="n">timeAxis</span><span class="p">,</span> <span class="n">deepsearch</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">avlyears</span><span class="p">:</span>
                <span class="n">avlyears</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Passed year </span><span class="si">%d</span><span class="s"> is not available&quot;</span> <span class="o">%</span> <span class="n">year</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">syearIdx</span> <span class="o">=</span> <span class="n">avlyears</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">eyearIdx</span> <span class="o">=</span> <span class="n">avlyears</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">avlyears</span> <span class="o">=</span> <span class="n">avlyears</span><span class="p">[</span><span class="n">syearIdx</span><span class="p">:</span> <span class="n">eyearIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c"># end of if year:</span>

    <span class="c"># check if smon &gt; emon or (smon == emon and sday &gt;= eday):</span>
    <span class="c"># if end day and end month is lower than the start day and start</span>
    <span class="c"># month, then we need to extract the both current and next year</span>
    <span class="c"># data. For eg : Winter Season (November to April).</span>
    <span class="c"># It can not be reversed for this winter season. We need to</span>
    <span class="c"># extract data from current year november month upto next year</span>
    <span class="c"># march month.</span>
    <span class="c">#</span>
    <span class="n">scomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">sday</span><span class="p">)</span>
    <span class="n">ecomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">eday</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ecomp</span><span class="o">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">scomp</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c"># satisfied if smon &gt; emon or (smon == emon and sday &gt;= eday):</span>
        <span class="c"># The end day and end month is lower than the start day and start</span>
        <span class="c"># month.</span>
        <span class="c"># increase one year to the enddate to extract the next year data.</span>
        <span class="n">adjyear</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c"># increase one year to the enddate comptime</span>
        <span class="n">ecomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">eday</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># satisfied smon &lt; emon</span>
        <span class="n">adjyear</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># end of if ecomp.cmp(scomp) == -1:</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">nodays</span><span class="p">:</span>
        <span class="c"># get the no of days between the start and end of the season.</span>
        <span class="n">nodays</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ecomp</span><span class="o">.</span><span class="n">torel</span><span class="p">(</span><span class="s">&#39;days since </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">scomp</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c"># ? why</span>
    <span class="c"># end of if not nodays:</span>

    <span class="n">totalYears</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># set totalYears as zero</span>
    <span class="c">#longitude = data.getLongitude()</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">varName</span><span class="p">]</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span>
    <span class="n">NT</span> <span class="o">=</span> <span class="n">nodays</span>  <span class="c"># No of days per segment</span>
    <span class="n">NL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>  <span class="c"># No of longitude</span>

<span class="c">#    NT = nodays  # No of days per segment</span>
<span class="c">#    NL = len(longitude) -1 # No of longitude</span>

    <span class="c"># make decision about the resultant latAxis, lonAxis dimension</span>
    <span class="c"># w.r.t either passed data is seasonal or yearly dataset.</span>
    <span class="k">if</span> <span class="n">nodays</span> <span class="o">&lt;=</span> <span class="mi">185</span><span class="p">:</span>
        <span class="c"># got season</span>
        <span class="n">newlon_limit</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">newlon_size</span> <span class="o">=</span> <span class="mi">21</span>
        <span class="c">#NT = 180</span>
    <span class="k">elif</span> <span class="n">nodays</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
        <span class="c"># got annual</span>
        <span class="n">newlon_limit</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">newlon_size</span> <span class="o">=</span> <span class="mi">39</span>
        <span class="c">#NT = 364</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Oops ! This season is more than 6 months !!! &quot;</span>
    <span class="c"># end of if nodays &lt;= 185:</span>
    <span class="n">newlat_size</span> <span class="o">=</span> <span class="mi">11</span>

    <span class="n">globmean</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">totvar</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c"># Initial Real data set. Function of space and time</span>
    <span class="n">EE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NT</span><span class="p">,</span> <span class="n">NL</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c">#OEE = numpy.zeros((NT+1,NL/2+1), dtype=float)</span>
    <span class="n">OEE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">newlon_size</span><span class="p">,</span> <span class="n">newlat_size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">PEE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">NL</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">wsave1</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">cffti</span><span class="p">(</span><span class="n">NL</span><span class="p">)</span>  <span class="c"># Initialize FFT for Longitude direction</span>
    <span class="n">wsave2</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">cffti</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>  <span class="c"># Initialize FFT for time direction</span>

    <span class="c"># cos window</span>
    <span class="k">if</span> <span class="n">window</span><span class="p">:</span>
        <span class="n">cos_window</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">45.</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">45.0</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="c"># end of if window:</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">avlyears</span><span class="p">:</span>
        <span class="c"># loop through available years of the data</span>
        <span class="c"># genearate the start of the current year (season)</span>
        <span class="n">sdate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sdate</span> <span class="ow">in</span> <span class="n">comptime</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sdate</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; is not available in the model data time&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;So selecting which ever is available in the passed season&quot;</span>
        <span class="c"># end of if not sdate in comptime:</span>

        <span class="c"># adjust the year (nextyear) to get the end season year to extract</span>
        <span class="c"># the season data correctly in both winter/summer seasons.</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="n">adjyear</span>
        <span class="c"># generate the end date either for current year or next year.</span>
        <span class="n">edate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># extract the season data from file object</span>
            <span class="n">seasonalData</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">sdate</span><span class="p">,</span> <span class="n">edate</span><span class="p">),</span> <span class="n">squeeze</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c">#seasonalData = data(time=(sdate, edate))</span>
        <span class="k">except</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">CDMSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Couldnt extracted seasonalData successfully for the year&quot;</span><span class="p">,</span> <span class="n">year</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s">&quot;So Skipping without extracting data&quot;</span>
            <span class="k">continue</span>
        <span class="c"># end of try:</span>
        <span class="k">print</span> <span class="s">&quot;Extracted seasonalData successfully for the year&quot;</span><span class="p">,</span> <span class="n">year</span>

        <span class="n">sdata_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seasonalData</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sdata_len</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">nodays</span> <span class="o">-</span> <span class="n">iglimit</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;The extracted seasonalData length </span><span class="si">%i</span><span class="s"> is less than </span><span class="si">%i</span><span class="s"> days&quot;</span> \
                                             <span class="o">%</span> <span class="p">(</span><span class="n">sdata_len</span><span class="p">,</span> <span class="n">nodays</span><span class="o">-</span><span class="n">iglimit</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;So skip this data to calculate the wavenumber for the year&quot;</span><span class="p">,</span> <span class="n">year</span>
            <span class="k">continue</span>
        <span class="c"># end of if sdata_len &lt; (nodays - iglimit):</span>

        <span class="c"># increament the no of years (only successfully extracted data !)</span>
        <span class="n">totalYears</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">nodays</span> <span class="o">&gt;=</span> <span class="n">sdata_len</span><span class="p">:</span>
            <span class="n">segmantData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nodays</span><span class="p">,</span> <span class="n">NL</span><span class="p">))</span>
            <span class="n">segmantData</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">sdata_len</span><span class="p">]</span> <span class="o">=</span> <span class="n">seasonalData</span>  <span class="c"># [:-1]#?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endday</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nodays</span> <span class="o">-</span> <span class="n">sdata_len</span><span class="p">)</span>
            <span class="n">segmantData</span> <span class="o">=</span> <span class="n">seasonalData</span><span class="p">[:</span><span class="o">-</span><span class="n">endday</span><span class="p">]</span>  <span class="c"># [:-1]#?</span>
        <span class="c"># end of if nodays &gt;= len(seasonalData):</span>

        <span class="c"># make memory free</span>
        <span class="k">del</span> <span class="n">seasonalData</span>
<span class="c">#        print segmantData.shape</span>
        <span class="c"># average over both time and longitude axis</span>
        <span class="n">globmean</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">segmantData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;equal&#39;</span><span class="p">,</span> <span class="s">&#39;equal&#39;</span><span class="p">])</span>  <span class="c">#(EEr /  float(NT*NL))</span>
        <span class="c"># average over time axis</span>
        <span class="n">ave_EEr</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">segmantData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>  <span class="c"># hope its correct</span>
        <span class="c"># according to the fortran code of mjo.. why is it so ?!</span>
<span class="c">#        ave_EEr = cdutil.averager(segmantData, axis=&#39;01&#39;,</span>
<span class="c">#                    weights=[&#39;equal&#39;, &#39;equal&#39;], action=&#39;sum&#39;) / float(NT)  # wrong method.. yes.</span>
        <span class="c">#print &quot;Ave_EER&quot;, ave_EEr</span>
        <span class="c"># average over the longitude axis</span>
        <span class="n">zm_EEr</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">segmantData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="c"># remove the time mean</span>
        <span class="n">EEr</span> <span class="o">=</span> <span class="n">segmantData</span> <span class="o">-</span> <span class="n">ave_EEr</span>
<span class="c">#        print globmean.shape</span>
        <span class="c"># remove the global mean</span>
<span class="c">#       # EEr = EEr - globmean  # is this only for allseason ????</span>

        <span class="c"># make memory free</span>
        <span class="k">del</span> <span class="n">segmantData</span>

        <span class="k">if</span> <span class="n">window</span><span class="p">:</span>
            <span class="c"># Taper first and last 45 days with cosine window</span>
            <span class="n">cos_window</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">45.0</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">EEr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span> <span class="o">=</span> <span class="n">EEr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span> <span class="o">*</span> <span class="n">cos_window</span><span class="p">[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="c">#print EEr[NT-46:].shape</span>
            <span class="c">#cos_window = (1 - numpy.cos(numpy.arange(2., 48) * numpy.pi/45.0)) * 0.5</span>
            <span class="n">EEr</span><span class="p">[</span><span class="o">-</span><span class="mi">46</span><span class="p">:]</span> <span class="o">=</span> <span class="n">EEr</span><span class="p">[</span><span class="o">-</span><span class="mi">46</span><span class="p">:]</span> <span class="o">*</span> <span class="n">cos_window</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="c">#cos_window = (1 - numpy.cos(numpy.arange(47., 1, -1) * numpy.pi/45.0)) * 0.5</span>
            <span class="c">#EEr[-46:] = EEr[-46:] * cos_window[:, numpy.newaxis]</span>
        <span class="c"># end of if window:</span>

        <span class="c"># do the square of the above anomaly val and then do average over</span>
        <span class="c"># both time and longitude axis</span>
        <span class="n">totvar</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">EEr</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;equal&#39;</span><span class="p">,</span> <span class="s">&#39;equal&#39;</span><span class="p">])</span>  <span class="c"># /float(NT*NL)</span>
        <span class="c"># Convert the multi-dimensional data into Complex format</span>
        <span class="n">CEE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="nb">complex</span><span class="p">)(</span><span class="n">EEr</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">EEr</span>
        <span class="n">coef1</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">cfftf</span><span class="p">(</span><span class="n">CEE</span><span class="p">,</span> <span class="n">wsave1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">NL</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">CEE</span>
        <span class="c"># here EE is the complex power spectrum array.</span>
        <span class="k">for</span> <span class="n">nl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NL</span><span class="p">):</span>
            <span class="n">EE</span><span class="p">[:,</span> <span class="n">nl</span><span class="p">]</span> <span class="o">=</span> <span class="n">fftpack</span><span class="o">.</span><span class="n">cfftf</span><span class="p">(</span><span class="n">coef1</span><span class="p">[:,</span> <span class="n">nl</span><span class="p">],</span> <span class="n">wsave2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
        <span class="c"># end of for nl in range(NL):</span>
        <span class="k">del</span> <span class="n">coef1</span>
        <span class="c"># Now lets Create array PEE(NL+1,NT+1) which contains</span>
        <span class="c"># the real power spectrum.</span>

        <span class="n">half_NL</span> <span class="o">=</span> <span class="n">NL</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">half_NT</span> <span class="o">=</span> <span class="n">NT</span><span class="o">/</span><span class="mi">2</span>

        <span class="c"># get the 1st dimension from 0 to half_NT+1. i.e exactly first half of</span>
        <span class="c"># the 1st dimension array.</span>
        <span class="c"># also get the 2nd dimension from 0 to half_NL+1. i.e exactly first</span>
        <span class="c"># half of the 2nd dimension array.</span>
        <span class="c"># Note : In half_NT+1 and half_NL+1, +1 plays role to indicate upto</span>
        <span class="c"># half_NT and half_NL.</span>
        <span class="n">tmpval</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">EE</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">half_NT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">half_NL</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span>
        <span class="c"># concatenate the reverse of 2nd dimension of above tmpval array and</span>
        <span class="c"># the ascending order of 2nd dimension of above tmpval array excluding</span>
        <span class="c"># one zeroth index values. (we need only one zeroth index values)</span>
        <span class="n">tmpval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tmpval</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tmpval</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># reverse the first dimension of the above tmpval array and store it</span>
        <span class="c"># into first half of PEE array.</span>
        <span class="n">PEE</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">half_NT</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="n">tmpval</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># get the 1st dimension from half_NT to NT-1. i.e exactly second half</span>
        <span class="c"># of the 1st dimension array.</span>
        <span class="c"># also get the 2nd dimension from 0 to half_NL+1. i.e exactly first</span>
        <span class="c"># half of the 2nd dimension array.</span>
        <span class="c"># Note : In half_NT+1 and half_NL+1, +1 plays role to indicate upto</span>
        <span class="c"># half_NT and half_NL.</span>
        <span class="n">tmpval</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">EE</span><span class="p">[</span><span class="n">half_NT</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">half_NL</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span>
        <span class="c"># concatenate the reverse of 2nd dimension of above tmpval array and</span>
        <span class="c"># the ascending order of 2nd dimension of above tmpval array excluding</span>
        <span class="c"># one zeroth index values. (we need only one zeroth index values)</span>
        <span class="n">tmpval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tmpval</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tmpval</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># reverse the first dimension of the above tmpval array and store it</span>
        <span class="c"># into second half of PEE array.</span>
        <span class="n">PEE</span><span class="p">[</span><span class="n">half_NT</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span>  <span class="n">tmpval</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


        <span class="c"># extract the OEE dimension from the PEE array</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">half_NT</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span> <span class="n">newlon_limit</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">half_NT</span> <span class="o">+</span> <span class="n">newlon_limit</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">half_NL</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">half_NL</span><span class="o">+</span> <span class="n">newlat_size</span>

        <span class="c"># add the resultant OEE through out the years loop.</span>
        <span class="n">OEE</span> <span class="o">+=</span> <span class="n">PEE</span><span class="p">[</span><span class="n">t1</span><span class="p">:</span><span class="n">t2</span><span class="p">,</span> <span class="n">l1</span><span class="p">:</span><span class="n">l2</span><span class="p">]</span>
    <span class="c"># end of for year in avlyears:</span>

    <span class="c"># get the average of OEE by divide the totalYears</span>
    <span class="n">OEE</span> <span class="o">=</span> <span class="n">OEE</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">totalYears</span><span class="p">)</span>

    <span class="c"># Frequency</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NT</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">half_NT</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">NT</span><span class="p">)</span>
    <span class="c">#ss = (numpy.arange(NL+1) - half_NL)  #???</span>
    <span class="c">#ss = ss[half_NT-newlon_limit+1: half_NT+newlon_limit]   #???</span>
    <span class="c"># slicing the needed frequencies alone. length should be newlon_size.</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span><span class="p">[</span><span class="n">half_NT</span><span class="o">-</span><span class="n">newlon_limit</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="n">half_NT</span><span class="o">+</span><span class="n">newlon_limit</span><span class="p">]</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">)</span>

    <span class="n">latAxis</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createAxis</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
    <span class="n">latAxis</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s">&#39;frequency&#39;</span>  <span class="c"># &#39;latitude&#39;</span>
    <span class="c">#latAxis.units = &#39;degrees_north&#39;</span>
    <span class="c">#latAxis.designateLatitude()</span>

    <span class="n">lonAxis</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createAxis</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
    <span class="n">lonAxis</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s">&#39;wavenumber&#39;</span>  <span class="c"># &#39;longitude&#39;</span>
    <span class="c">#lonAxis.units = &#39;degrees_east&#39;</span>
    <span class="c">#lonAxis.designateLongitude()</span>

    <span class="n">var</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">OEE</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
    <span class="n">var</span><span class="o">.</span><span class="n">setAxisList</span><span class="p">([</span><span class="n">latAxis</span><span class="p">,</span> <span class="n">lonAxis</span><span class="p">])</span>
    <span class="n">var</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">varName</span> <span class="c"># &#39;power&#39;</span>
    <span class="n">var</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s">&#39;Power of &#39;</span> <span class="o">+</span> <span class="n">varName</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">var</span>
<span class="c"># end of def waveNumber(data, sday, smon, eday, emon, hr=0, nodays=None):</span>

</div>
<span class="k">def</span> <span class="nf">summerWaveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">eday</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">emon</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">cos_window</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">waveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span>
                        <span class="n">window</span><span class="o">=</span><span class="n">cos_window</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="n">nodays</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c"># end of def summerPowerSpectrum(...):</span>


<span class="k">def</span> <span class="nf">winterWaveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">eday</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">emon</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">cos_window</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">waveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span>
                        <span class="n">window</span><span class="o">=</span><span class="n">cos_window</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="n">nodays</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c"># end of def winterPowerSpectrum(...):</span>


<span class="k">def</span> <span class="nf">annualWaveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">smon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eday</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">emon</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">hr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">cos_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">waveNumber</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">sday</span><span class="p">,</span> <span class="n">smon</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">emon</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span>
                        <span class="n">window</span><span class="o">=</span><span class="n">cos_window</span><span class="p">,</span> <span class="n">nodays</span><span class="o">=</span><span class="n">nodays</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c"># end of def winterPowerSpectrum(...):</span>


<span class="k">def</span> <span class="nf">_getDataFromFObj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fobj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    varName : variable name to extract data.</span>

<span class="sd">    fobj : It is cdms2.opened file object.</span>
<span class="sd">           It will not close this file obj. You have to close it.</span>

<span class="sd">    KWArgs:</span>
<span class="sd">        year : It takes either integer or tuple of integers.</span>
<span class="sd">               It will extract the passed years data.</span>

<span class="sd">        time : It takes cdtime.comptime formate or tuple or</span>
<span class="sd">               string of comptime.</span>

<span class="sd">        region : It is region object</span>
<span class="sd">        latitude : latitude tuple or integer</span>
<span class="sd">        longitude : longitude tuple or integer</span>
<span class="sd">        level : level list or integer</span>

<span class="sd">    Returns :</span>
<span class="sd">        Extracted data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lat</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;latitude&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;longitude&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;region&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">lev</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;level&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">sdate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">edate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">sdate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">edate</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">comptime</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">sdate</span><span class="p">,</span> <span class="n">edate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">kwarg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">time</span> <span class="ow">and</span> <span class="n">lev</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">)</span>
        <span class="c"># end of if region:</span>
    <span class="k">elif</span> <span class="n">time</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lev</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="c"># end of if region:</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">time</span> <span class="ow">and</span> <span class="n">lev</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="p">)</span>
        <span class="c"># end of if region:</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">time</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lev</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lat</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">lon</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fobj</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span>
        <span class="c"># end of if region:</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c"># end of if time and lev:</span>
    <span class="k">return</span> <span class="n">data</span>
<span class="c"># end of def _getData(varName, fobj, **kwarg):</span>


<div class="viewcode-block" id="areaAvg"><a class="viewcode-back" href="../mjo.html#psutils.areaAvg">[docs]</a><span class="k">def</span> <span class="nf">areaAvg</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the area averaged data by accessing the var data from the fpath</span>
<span class="sd">    itself by extracting needed portion of data only by the following</span>
<span class="sd">    key word arguments.</span>

<span class="sd">    KWargs : (latitude and/or longitude) or (region) and/or level</span>

<span class="sd">    Written by : Arulalan.T</span>

<span class="sd">    Date : 08.01.2013</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">_getDataFromFObj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c"># do the area average over lat, lon alone.</span>
    <span class="c"># The time &amp; level axis should retain after done the area avg.</span>
    <span class="n">avgData</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s">&#39;xy&#39;</span><span class="p">)</span>
    <span class="c"># make memory free</span>
    <span class="k">del</span> <span class="n">data</span>
    <span class="c"># reset its id</span>
    <span class="n">avgData</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">varName</span>
    <span class="k">return</span> <span class="n">avgData</span>
<span class="c"># end of def areaAvg(varName, fpath, **kwarg):</span>

</div>
<div class="viewcode-block" id="zonalAvg"><a class="viewcode-back" href="../mjo.html#psutils.zonalAvg">[docs]</a><span class="k">def</span> <span class="nf">zonalAvg</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the zonal averaged data by accessing the var data from the fpath</span>
<span class="sd">    itself by extracting needed portion of data only by the following</span>
<span class="sd">    key word arguments.</span>

<span class="sd">    KWargs : (latitude and/or longitude) or (region) and/or level</span>

<span class="sd">    Returns : It vanishes the latitude in the input data and returns it.</span>

<span class="sd">    Written by : Arulalan.T</span>

<span class="sd">    Date : 08.01.2013</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">_getDataFromFObj</span><span class="p">(</span><span class="n">varName</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c">#    lonAxis = data.getLongitude()</span>
<span class="c">#    timeAxis = data.getTime()</span>
<span class="c">#    levAxis = data.getLevel()</span>

    <span class="c"># do the area average over latitude alone.</span>
    <span class="c"># The time &amp; level axis should retain after done the area avg.</span>
    <span class="n">avgData</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span> <span class="c">#, weight=&#39;equal&#39;) ##?? &#39;equal&#39; or &#39;area&#39;</span>
    <span class="c"># reset its id</span>
    <span class="n">avgData</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">varName</span>

<span class="c">#    axislist = [axis for axis in (timeAxis, levAxis, lonAxis) if axis]</span>
<span class="c">#    setAxisList(axislist)</span>
    <span class="c"># uncomment the above lines if it dont have axis information</span>
    <span class="c"># make memory free</span>
    <span class="k">del</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">avgData</span>
<span class="c"># end of def zonalAvg(varName, fpath, **kwarg):</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">mmDiagnosis 1a documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Arulalan.T, Dr.Krishna AchutaRao, Dileepkumar.R.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>