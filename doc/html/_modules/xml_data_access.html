<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xml_data_access &mdash; mmDiagnosis 1a documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="mmDiagnosis 1a documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">mmDiagnosis 1a documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for xml_data_access</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: xml_data_access</span>
<span class="sd">   :synopsis: A useful module for grib data access through the xml which has</span>
<span class="sd">              created by cdscan</span>
<span class="sd">.. moduleauthor:: Arulalan.T &lt;arulalant@gmail.com&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">cdms2</span>
<span class="kn">import</span> <span class="nn">cdtime</span>
<span class="kn">import</span> <span class="nn">cdutil</span>
<span class="kn">from</span> <span class="nn">timeutils</span> <span class="kn">import</span> <span class="n">TimeUtility</span>
<span class="c"># setting the absolute path of the previous to previous directory</span>
<span class="c"># getting the this py module path by __file__ variable</span>
<span class="c"># pass that __file__ to the os.path.dirname, returns the path of this module</span>
<span class="n">__diagnosisutilDir__</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">previousDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">__diagnosisutilDir__</span><span class="p">,</span> <span class="s">&#39;../..&#39;</span><span class="p">))</span>
<span class="c"># adding the previous path to python path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">previousDir</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">diag_setup.varsdict</span> <span class="kn">import</span> <span class="n">variables</span>


<span class="k">class</span> <span class="nc">_XmlAccessError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">XmlAccessError Error : &quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">i</span>


<span class="k">class</span> <span class="nc">_XmlAccessTypeError</span><span class="p">(</span><span class="n">_XmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_XmlAccessInputError</span><span class="p">(</span><span class="n">_XmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_RainfallAccessError</span><span class="p">(</span><span class="n">_XmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_RainfallAccessTypeError</span><span class="p">(</span><span class="n">_XmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">XmlAccess</span><span class="p">(</span><span class="n">TimeUtility</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmlPath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        XmlAccess.__init__ : It returns the instance of this XmlAccess class.</span>

<span class="sd">        Condition :</span>
<span class="sd">                  xmlPath is mandatory.</span>

<span class="sd">        Inputs :</span>
<span class="sd">          xmlPath is absolute one. This xml should be created by cdscan cmd.</span>

<span class="sd">        Usage:</span>
<span class="sd">          Assigning to the instance variable for Xml_Access class object</span>

<span class="sd">        Written by: Arulalan.T</span>

<span class="sd">        Date: 29.05.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmlpath</span> <span class="o">=</span> <span class="n">xmlPath</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmlpath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">_XmlAccessError</span><span class="p">(</span><span class="s">&quot;the xml file is not exist </span><span class="se">\</span>
<span class="s">                        in the path </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmlpath</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmlpath</span><span class="p">)</span>
        <span class="c"># initializing the TimeUtility class __init__ attributes</span>
        <span class="n">TimeUtility</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c"># end of def __init__(self,xmlPath):</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the variable as &lt;class &#39;cdms2.variable.DatasetVariable&#39;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
    <span class="c"># end of def __getitem__(self, var):</span>

    <span class="k">def</span> <span class="nf">listvariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the listvariable of cdms2 open object method result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="o">.</span><span class="n">listvariable</span><span class="p">()</span>
    <span class="c"># end of def listvariable(self):</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the xml file object which is opened by cdms2, while creating</span>
<span class="sd">        an instance to this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c"># end of def close(self):</span>

    <span class="k">def</span> <span class="nf">getXmlData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getXmlData`: Extract the data from the xml file which has</span>
<span class="sd">                            created by the cdscan command</span>
<span class="sd">        Inputs : var is mandatory.</span>
<span class="sd">                 if we passed date,level then it should return var accordingly</span>
<span class="sd">                 By default level takes &#39;all&#39; levels.</span>
<span class="sd">                 Pass either (lat,lon) or region keyword arg</span>

<span class="sd">        Written by : Arulalan.T</span>

<span class="sd">        Date : 29.05.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="o">.</span><span class="n">listvariable</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">_XmlAccessError</span><span class="p">(</span><span class="s">&quot;the xml file </span><span class="si">%s</span><span class="s"> doesnt have the passed </span><span class="se">\</span>
<span class="s">                    xmlvar </span><span class="si">%s</span><span class="s">.Choose correct var from the available vars </span><span class="se">\</span>
<span class="s">                  here&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmlpath</span><span class="p">,</span> <span class="n">var</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="o">.</span><span class="n">listvariable</span><span class="p">())</span>
        <span class="c"># make copy level</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">level</span>
        <span class="c"># make free memory</span>
        <span class="k">del</span> <span class="n">level</span>
        <span class="k">if</span> <span class="n">lev</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">lev</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">lev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">all_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">getLevel</span><span class="p">()[:]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">all_levels</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;the passed level </span><span class="si">%s</span><span class="s"> is not </span><span class="se">\</span>
<span class="s">                    present in the levelAxis. Choose one from the </span><span class="se">\</span>
<span class="s">                    following levels </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lev</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_levels</span><span class="p">)))</span>

        <span class="c"># get the squeeze option from user.</span>
        <span class="c"># squeeze must be keyword argument only</span>
        <span class="k">if</span> <span class="s">&#39;squeeze&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
            <span class="n">squeezeVal</span> <span class="o">=</span> <span class="n">latlonregion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;squeeze&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">squeezeVal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">_XmlAccessError</span><span class="p">(</span><span class="s">&quot;squeeze option must be either 0 or 1</span><span class="se">\</span>
<span class="s">                                                    by default it takes 0&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># default squeeze setting</span>
            <span class="n">squeezeVal</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="p">((</span><span class="s">&#39;lat&#39;</span> <span class="ow">or</span> <span class="s">&#39;lon&#39;</span> <span class="ow">or</span> <span class="s">&#39;latitude&#39;</span> <span class="ow">or</span> <span class="s">&#39;longitude&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">latlonregion</span>
                                            <span class="ow">and</span> <span class="s">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">):</span>
            <span class="c"># find out if user passed (lat or lon) and region</span>
            <span class="k">raise</span> <span class="n">_XmlAccessError</span><span class="p">(</span><span class="s">&quot;Pass either region or lat,lon </span><span class="se">\</span>
<span class="s">                                  key word arguments. Do not pass all &quot;</span><span class="p">)</span>
        <span class="c"># initializing lat,lon,region variables</span>
        <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">regionVar</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;lat&#39;</span> <span class="ow">or</span> <span class="s">&#39;latitude&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">latlonregion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;latitude&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">latlonregion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;latitude&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;lon&#39;</span> <span class="ow">or</span> <span class="s">&#39;longitude&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">latlonregion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">latlonregion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;longitude&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">latlonregion</span><span class="p">:</span>
            <span class="c"># calling the region dictionary from the regions module</span>
            <span class="n">regionVar</span> <span class="o">=</span> <span class="n">latlonregion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;region&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">lon</span><span class="p">:</span>
                <span class="c"># extract the partial data w.r.t passed lat &amp; lon</span>
                <span class="k">if</span> <span class="n">lev</span><span class="p">:</span>
                    <span class="c"># extract paticular level only</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span>
                                       <span class="n">latitude</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># extract all the levels</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">latitude</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span>
                                                        <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">regionVar</span><span class="p">:</span>
                <span class="c"># extract the partial data w.r.t passed region variable</span>
                <span class="k">if</span> <span class="n">lev</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">regionVar</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">lev</span><span class="p">,</span>
                                              <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">regionVar</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># extract the whole (available lat,lon &amp; time) variable</span>
                <span class="k">if</span> <span class="n">lev</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_dates_DTGT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span><span class="o">.</span><span class="n">asDTGTime</span><span class="p">()[:]</span>
            <span class="n">all_dates_COMP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span><span class="o">.</span><span class="n">asComponentTime</span><span class="p">()[:]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comppattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
                    <span class="c"># checking date and retain date as same as passed by user</span>
                    <span class="n">tmpdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp2timestr</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tmpdate</span> <span class="ow">in</span> <span class="n">all_dates_DTGT</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The passed date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                           <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_COMP</span><span class="p">)))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymdpattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
                    <span class="c"># checking date and change date as component object</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates_COMP</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The passed date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                            <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_DTGT</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;date must be either yyyymmdd </span><span class="se">\</span>
<span class="s">                               yyymmddhh or  or cdtime.comptime object/string</span><span class="se">\</span>
<span class="s">                                                               formate only &quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">startdate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">enddate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c"># startdate checking begins</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">startdate</span><span class="p">))</span> <span class="o">==</span> <span class="s">&quot;&lt;type &#39;comptime&#39;&gt;&quot;</span><span class="p">):</span>
                    <span class="c"># component time object passed</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">comppattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">startdate</span><span class="p">):</span>
                    <span class="c"># checking start date</span>
                    <span class="n">startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp2timestr</span><span class="p">(</span><span class="n">startdate</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">startdate</span> <span class="ow">in</span> <span class="n">all_dates_DTGT</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The start date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                             in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                         <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_COMP</span><span class="p">)))</span>
                    <span class="c"># retain start date as same as passed by user</span>
                    <span class="n">startdate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymdpattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">startdate</span><span class="p">):</span>
                    <span class="c"># checking startdate and change date as component object</span>
                    <span class="n">startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">startdate</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">startdate</span> <span class="ow">in</span> <span class="n">all_dates_COMP</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The start date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                       <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">startdate</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_DTGT</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;startdate must be either </span><span class="se">\</span>
<span class="s">                                                yyyymmdd or yyyymmddhh or </span><span class="se">\</span>
<span class="s">                                 cdtime.comptime object/string formate only&quot;</span><span class="p">)</span>
                <span class="c"># startdate checking ends</span>
                <span class="c"># enddate checking begins</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">enddate</span><span class="p">))</span> <span class="o">==</span> <span class="s">&quot;&lt;type &#39;comptime&#39;&gt;&quot;</span><span class="p">):</span>
                    <span class="c"># component time object passed</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">comppattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">enddate</span><span class="p">):</span>
                    <span class="c"># checking end date</span>
                    <span class="n">enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp2timestr</span><span class="p">(</span><span class="n">enddate</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">enddate</span> <span class="ow">in</span> <span class="n">all_dates_DTGT</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The end date </span><span class="si">%s</span><span class="s"> is not </span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                        <span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_COMP</span><span class="p">)))</span>
                     <span class="c"># retain end date as same as passed by user</span>
                    <span class="n">enddate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymdpattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">enddate</span><span class="p">):</span>
                    <span class="c"># checking enddate and change date as component object</span>
                    <span class="n">enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">enddate</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">enddate</span> <span class="ow">in</span> <span class="n">all_dates_COMP</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The end date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                         <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">enddate</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_DTGT</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;enddate must be either </span><span class="se">\</span>
<span class="s">                                                yyyymmdd or yyyymmddhh or </span><span class="se">\</span>
<span class="s">                                 cdtime.comptime object/string formate only&quot;</span><span class="p">)</span>
                <span class="c"># enddate checking ends</span>
                <span class="n">date</span> <span class="o">=</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="c"># interger type of date input must be either yyymmddhh or</span>
                <span class="c"># yyyymmdd formate only</span>
                <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymdpattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
                    <span class="c"># checking date and change date as component object</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates_COMP</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The passed date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                            <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_COMP</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;date must be eitehr yyyymmdd </span><span class="se">\</span>
<span class="s">                               yyymmddhh or  or cdtime.comptime object/string</span><span class="se">\</span>
<span class="s">                                                               formate only &quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">))</span> <span class="o">==</span> <span class="s">&quot;&lt;type &#39;comptime&#39;&gt;&quot;</span><span class="p">:</span>
                <span class="c"># component time object passed</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates_COMP</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_XmlAccessInputError</span><span class="p">(</span><span class="s">&quot;The passed date </span><span class="si">%s</span><span class="s"> is not</span><span class="se">\</span>
<span class="s">                            in the timeAxis. Choose one date from here </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                            <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">all_dates_COMP</span><span class="p">)))</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="c"># slice args passed</span>
                <span class="k">pass</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_XmlAccessTypeError</span><span class="p">(</span><span class="s">&quot;The date should be either string </span><span class="se">\</span>
<span class="s">                  or tuple type only. But you passed </span><span class="si">%s</span><span class="s"> type &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">lat</span> <span class="ow">and</span> <span class="n">lon</span><span class="p">:</span>
                <span class="c"># extract the partial data w.r.t passed lat &amp; lon</span>
                <span class="k">if</span> <span class="n">lev</span><span class="p">:</span>
                    <span class="c"># extract paticular level only</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">lev</span><span class="p">,</span>
                                    <span class="n">longitude</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">latitude</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span>
                                               <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># extract all the levels</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span>
                                      <span class="n">latitude</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">regionVar</span><span class="p">:</span>
                <span class="c"># extract the partial data w.r.t passed region variable</span>
                <span class="k">if</span> <span class="n">lev</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">regionVar</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span>
                                 <span class="n">level</span> <span class="o">=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">regionVar</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span>
                                              <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># extract the whole (available lat,lon) variable</span>
                <span class="k">if</span> <span class="n">lev</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span>
                                 <span class="n">level</span> <span class="o">=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">VAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlobj</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span>
                                              <span class="n">squeeze</span> <span class="o">=</span> <span class="n">squeezeVal</span><span class="p">)</span>
        <span class="c"># end of if date == None:</span>

        <span class="c"># Resetting the var id once we extracted by region or lat,lon data</span>
        <span class="n">VAR</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">var</span>
        <span class="k">return</span> <span class="n">VAR</span>
    <span class="c"># end of def getXmlData(...):</span>
<span class="c"># end of class Xml_Access:</span>

<span class="k">class</span> <span class="nc">_GribXmlAccessError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">GribXmlAccessError Error : &quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">i</span>


<span class="k">class</span> <span class="nc">_GribInputStringError</span><span class="p">(</span><span class="n">_GribXmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_GribInputError</span><span class="p">(</span><span class="n">_GribXmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_GribAccessError</span><span class="p">(</span><span class="n">_GribXmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_GribAccessTypeError</span><span class="p">(</span><span class="n">_GribXmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">_RainfallAccessError</span><span class="p">(</span><span class="n">_GribXmlAccessError</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="GribXmlAccess"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess">[docs]</a><span class="k">class</span> <span class="nc">GribXmlAccess</span><span class="p">(</span><span class="n">XmlAccess</span><span class="p">,</span> <span class="n">TimeUtility</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; xml access methods &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XmlDir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">XmlDir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_collectXmlPath</span><span class="p">(</span><span class="n">XmlDir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;You must pass the xml directory&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span> <span class="o">=</span> <span class="p">{</span><span class="mo">01</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">48</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">72</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">96</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">120</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                               <span class="mi">144</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">168</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">192</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="mi">216</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="mi">240</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
        <span class="c"># initializing the anl and fcst xml objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_anlxmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f01xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f24xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f48xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f72xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f96xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f120xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f144xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f168xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f192xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f216xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f240xmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># initializing the observation xml objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obsxmlobj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># initializing the rainfall xml objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlPath</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlVar</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rainfallModel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># we must call the inherited class&#39;s __init__ method.</span>
        <span class="c"># then only we can access all its super class member variables</span>
        <span class="c"># initializing the TimeUtility class __init__ attributes</span>
        <span class="n">TimeUtility</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c"># end of def __init__(self, XmlDir):</span>

    <span class="k">def</span> <span class="nf">_collectXmlPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmldir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collecting xml file path from the passed directory into the dictionary</span>
<span class="sd">        by parsing regular expression  for future purpose through out the</span>
<span class="sd">        live session of this program</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># setting pattern for the anl and fcst hours xml file</span>
        <span class="n">anlpattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)anl(.*)xml&#39;</span>
        <span class="n">f01pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)01(.*)xml&#39;</span>
        <span class="n">f24pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)24(.*)xml&#39;</span>
        <span class="n">f48pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)48(.*)xml&#39;</span>
        <span class="n">f72pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)72(.*)xml&#39;</span>
        <span class="n">f96pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)96(.*)xml&#39;</span>
        <span class="n">f120pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)120(.*)xml&#39;</span>
        <span class="n">f144pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)144(.*)xml&#39;</span>
        <span class="n">f168pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)168(.*)xml&#39;</span>
        <span class="n">f192pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)192(.*)xml&#39;</span>
        <span class="n">f216pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)216(.*)xml&#39;</span>
        <span class="n">f240pattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)fcst(.*)240(.*)xml&#39;</span>
        <span class="n">obspattern</span> <span class="o">=</span> <span class="s">r&#39;all(.*)obs(.*)xml&#39;</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">xmldir</span><span class="p">)</span> <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.xml&#39;</span><span class="p">)]</span>
        <span class="k">print</span> <span class="s">&quot;Collecting xml files path</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">for</span> <span class="n">xml</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>            
            <span class="n">xmlabspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xmldir</span><span class="p">,</span> <span class="n">xml</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">anlpattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get anl xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;anl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f01pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 01 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f01&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f24pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 24 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f24&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f48pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 48 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f48&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f72pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 72 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f72&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f96pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 96 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f96&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f120pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 120 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f120&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f144pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 144 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f144&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f168pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 168 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f168&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f192pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get observation xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f192&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f240pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 144 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f240&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f216pattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get fcst 168 hr xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;f216&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">obspattern</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                <span class="c"># get observation xml file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="p">[</span><span class="s">&#39;obs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmlabspath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;unwanted xml are present in the directory&quot;</span>
            <span class="c"># end of if re.search(anlpattern, xml, re.M|re.I):</span>
        <span class="c"># end of for xml in files:</span>
    <span class="c"># end of def _collectXmlPath(self, xmldir):</span>

    <span class="k">def</span> <span class="nf">_getXmlAccessObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _getXmlAccessObj : get the XmlAccess class object, to access the xml</span>
<span class="sd">        and getData.By passing the anl or obs and/or fcst and its hours, this should</span>
<span class="sd">        return its appropriate object.</span>
<span class="sd">        If the object is already exists in the memory means, it just retun</span>
<span class="sd">        that object as it is.</span>
<span class="sd">        If not exist means, if xml directory contains the needed file means</span>
<span class="sd">        it should genearate new object for that. (now it exists in memory)</span>

<span class="sd">        If xml directory doesnot contain needed file means, it should return</span>
<span class="sd">        None</span>

<span class="sd">        Written by : Arulalan.T</span>

<span class="sd">        Date : 10.07.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;anl&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anlxmlobj</span><span class="p">:</span>
                <span class="c"># anlxlmobj is None</span>
                <span class="n">xmlPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;anl&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_anlxmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anlxmlobj</span>

        <span class="k">elif</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;obs&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obsxmlobj</span><span class="p">:</span>
                <span class="c"># anlxlmobj is None</span>
                <span class="n">xmlPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;obs&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_obsxmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obsxmlobj</span>

        <span class="k">elif</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;fcst&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">hour</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hour</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;hour must be digit&quot;</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span> <span class="o">+</span> <span class="n">hour</span>
                <span class="n">xmlPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">xmlPath</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;01&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f01xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f01xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f01xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;24&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f24xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f24xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f24xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;48&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f48xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f48xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f48xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;72&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f72xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f72xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f72xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;96&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f96xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f96xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f96xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;120&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f120xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f120xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f120xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;144&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f144xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f144xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f144xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;168&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f168xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f168xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f168xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;192&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f192xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f192xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f192xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;240&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f240xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f240xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f240xmlobj</span>

                <span class="k">elif</span> <span class="n">hour</span> <span class="o">==</span> <span class="s">&#39;216&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f216xmlobj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_f216xmlobj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="n">xmlPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f216xmlobj</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;wrong hour </span><span class="si">%s</span><span class="s"> passed,cant </span><span class="se">\</span>
<span class="s">                                create xmlobj for that &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hour</span><span class="p">))</span>
               <span class="c"># end of if hour:</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;you must pass the hour to choose </span><span class="se">\</span>
<span class="s">                                          fcst xml file &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;Type either &#39;a&#39; or &#39;f&#39; or &#39;o&#39; &quot;</span><span class="p">)</span>
        <span class="c"># end of if Type in [&#39;a&#39;, &#39;anl&#39;]:</span>
    <span class="c"># end of  def _getXmlAccessObj(self, Type, hour=None):</span>

<div class="viewcode-block" id="GribXmlAccess.closeXmlObjs"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.closeXmlObjs">[docs]</a>    <span class="k">def</span> <span class="nf">closeXmlObjs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`closeXmlObjs`: close all the opened xml file objects by</span>
<span class="sd">        cdms2. If we called this method, it will check all the 8 xml objects</span>
<span class="sd">        are either opened or not. If that is opened by cdms2 means, it will</span>
<span class="sd">        close that file object properly. We must call this method for the</span>
<span class="sd">        safety purpose.</span>

<span class="sd">        ..note:: If we called this method, at the end of the program then</span>
<span class="sd">            it should be optimized one. If this method called at any inter</span>
<span class="sd">            mediate level means, then again it need to create the xml object.</span>

<span class="sd">        Written By: Arulalan.T</span>

<span class="sd">        Date : 10.09.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xmlobjs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_obsxmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anlxmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f01xmlobj</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">_f24xmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f48xmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f72xmlobj</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">_f96xmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f120xmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f144xmlobj</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">_f168xmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f192xmlobj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f216xmlobj</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">_f240xmlobj</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">xmlobj</span> <span class="ow">in</span> <span class="n">xmlobjs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xmlobj</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># close the file object which is opened by cdms2</span>
                    <span class="n">xmlobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
    <span class="c"># end of def closeXmlObjs(self):</span>
</div>
<div class="viewcode-block" id="GribXmlAccess.getXmlPath"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.getXmlPath">[docs]</a>    <span class="k">def</span> <span class="nf">getXmlPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getXmlPath`: To get the xml&#39;s absolute path.</span>

<span class="sd">        Inputs : Type is either &#39;a&#39; or &#39;o&#39; or &#39;f&#39; or &#39;r&#39;</span>
<span class="sd">                 hour is mandatory when you pass &#39;f&#39; or &#39;r&#39;.</span>
<span class="sd">                 &#39;a&#39; - analysis, &#39;f&#39; - forecast,</span>
<span class="sd">                 &#39;o&#39; - observation, &#39;r&#39; - reference.</span>
<span class="sd">        Written by : Arulalan.T</span>

<span class="sd">        Date : 21.08.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;anl&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;anl&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;obs&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;obs&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;fcst&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">hour</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hour</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;hour must be digit&quot;</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span> <span class="o">+</span> <span class="n">hour</span>
                <span class="n">xmlPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_globalXml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xmlPath</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">xmlPath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;wrong hour </span><span class="si">%s</span><span class="s"> passed,cant </span><span class="se">\</span>
<span class="s">                                find fcst xml path for that. Choose correct</span><span class="se">\</span>
<span class="s">                                hour from this </span><span class="si">%s</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hour</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;you must pass the hour to choose </span><span class="se">\</span>
<span class="s">                                          fcst xml file &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribXmlAccessError</span><span class="p">(</span><span class="s">&quot;Type either &#39;a&#39; or &#39;f&#39; &quot;</span><span class="p">)</span>
    <span class="c"># end of  def _getXmlAccessObj(self, Type, hour=None):</span>
</div>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inputs : var, Type, hour</span>

<span class="sd">        Usage : var is a variable which should be in the xml file</span>
<span class="sd">                Choose need Type like &#39;a&#39; or &#39;o&#39; or &#39;f&#39; or &#39;r&#39;.</span>
<span class="sd">                hour is must when Type is &#39;f&#39; or &#39;r&#39;.</span>
<span class="sd">                &#39;a&#39; - analysis, &#39;f&#39; - forecast, &#39;o&#39; - observation</span>
<span class="sd">                &#39;r&#39; - reference.</span>
<span class="sd">                Get the variable as &lt;class &#39;cdms2.variable.DatasetVariable&#39;&gt;</span>
<span class="sd">                by passing the Type and hour (if needed).</span>

<span class="sd">                This DatasetVariable is efficient one, to access its</span>
<span class="sd">                dimensions and its data whenever, whichever need.</span>

<span class="sd">        example :</span>
<span class="sd">            &gt;&gt;&gt; obj = x.GribXmlAccess(&#39;/NCMRWF/all_xml&#39;)</span>
<span class="sd">            &gt;&gt;&gt; obj[&#39;ugrdprs&#39;,&#39;a&#39;]</span>
<span class="sd">            &gt;&gt;&gt; &lt;Variable: ugrdprs, dataset: none, shape: (129, 26, 361, 720)&gt;</span>
<span class="sd">             .. note:: Here we passed &#39;a&#39; as Type.</span>

<span class="sd">            &gt;&gt;&gt; obj[&#39;ugrdprs&#39;,&#39;f&#39;,48]</span>
<span class="sd">            &gt;&gt;&gt; &lt;Variable: ugrdprs, dataset: none, shape: (129, 26, 361, 720)&gt;</span>
<span class="sd">             .. note:: Here we passed &#39;f&#39; as Type and 48 as hour</span>

<span class="sd">        Written By : Arulalan.T</span>

<span class="sd">        Date : 19.08.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;You must pass var and Type&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Type</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;fcst&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;You must pass hour as third arg to</span><span class="se">\</span>
<span class="s">                                     choose fcst file&quot;</span><span class="p">)</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">xmlobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getXmlAccessObj</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">xmlobj</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;argument must be either string or tupe&quot;</span><span class="p">)</span>
    <span class="c"># end of def __getitem__(self, args):</span>

<div class="viewcode-block" id="GribXmlAccess.listvariable"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.listvariable">[docs]</a>    <span class="k">def</span> <span class="nf">listvariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:&#39;listvariable&#39;: By passing Type and/or hour args to this method,</span>
<span class="sd">        it will return the listvariable method of the appropriate xml file.</span>

<span class="sd">        Returns the listvariable of cdms2 open object method result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmlobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getXmlAccessObj</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xmlobj</span><span class="o">.</span><span class="n">listvariable</span><span class="p">()</span>
    <span class="c"># end of def listvariable(self, Type, hour=None):</span>
</div>
<div class="viewcode-block" id="GribXmlAccess.findPartners"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.findPartners">[docs]</a>    <span class="k">def</span> <span class="nf">findPartners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">returnType</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`findPartners`: To find the partners of the any particular</span>
<span class="sd">        day anl or any particular day and hour of the fcst.</span>
<span class="sd">        Each fcst file(day) has its truth anl file(day).</span>
<span class="sd">        i.e. today 24 hour fcst file&#39;s partner is tomorrow&#39;s truth anl file.</span>
<span class="sd">        today 48 hour fcst file&#39;s partner is the day after tomorrow&#39;s</span>
<span class="sd">        truth anl file. Keep going on the fcst vc anl files.</span>

<span class="sd">        Same concept for anl files partner but in reverse concept.</span>
<span class="sd">        Today&#39;s truth anl file&#39;s partners are yesterdays&#39; 24 hour fcst file,</span>
<span class="sd">        day before yesterday&#39;s 48 hour fcst file and keep going backward ...</span>

<span class="sd">        This what we are calling as the partners of anl and fcst files.</span>
<span class="sd">        For present fcst hours partner is future anl file and for present anl</span>
<span class="sd">        partners are the past fcst hours files.</span>

<span class="sd">        Condition :</span>

<span class="sd">                  if &#39;f&#39; as passed then hour is mandatory one</span>
<span class="sd">                  else &#39;a&#39; as passed then hour is optional one.</span>
<span class="sd">                  returnType either &#39;c&#39; or &#39;s&#39;</span>
<span class="sd">        Inputs :</span>

<span class="sd">           Type = &#39;f&#39; or &#39;a&#39; or &#39;o&#39; i.e fcst or anl or obs file</span>
<span class="sd">           date must be cdtime.comptime object or its string formate</span>
<span class="sd">           hour is like 24 multiples in case availability of the fcst files</span>

<span class="sd">        Outputs :</span>

<span class="sd">               If &#39;f&#39; has passed this method returns a corresponding partner</span>
<span class="sd">               of the anlysis date in cdtime.comptime object</span>
<span class="sd">               If &#39;a&#39; or &#39;o&#39; has passed this method returns a dictionary.</span>
<span class="sd">               It contains the availability of the fcst hours as key and its</span>
<span class="sd">               corresponding fcst date in cdtime.comptime object as value of</span>
<span class="sd">               the dict.</span>

<span class="sd">               we can get the return date as yyyymmdd string formate by</span>
<span class="sd">               passing returnType = &#39;s&#39;</span>

<span class="sd">         Usage :</span>

<span class="sd">           example 1 :</span>
<span class="sd">              &gt;&gt;&gt; findPartners(&#39;f&#39;,&#39;2010-5-25&#39;,24)</span>
<span class="sd">                  2010-5-26 0:0:0.0</span>

<span class="sd">               .. note:: The passed date in comptime in string type.</span>

<span class="sd">              &gt;&gt;&gt; findPartners(&#39;f&#39;,cdtime.comptime(2010,5,25),24)</span>
<span class="sd">                  2010-5-26 0:0:0.0</span>

<span class="sd">               .. note:: The passed date in comptime object itself.</span>

<span class="sd">              &gt;&gt;&gt; findPartners(&#39;a&#39;,&#39;2010-5-26&#39;)</span>
<span class="sd">                  {24: 2010-5-25 0:0:0.0}</span>

<span class="sd">               .. note:: Returns dictionary which contains key as hour and its</span>
<span class="sd">                        corresponding date</span>

<span class="sd">           example 2 :</span>
<span class="sd">              &gt;&gt;&gt; findPartners(&#39;f&#39;,&#39;2010-5-25&#39;,72)</span>
<span class="sd">                  2010-5-28 0:0:0.0</span>

<span class="sd">              &gt;&gt;&gt; findPartners(&#39;a&#39;,&#39;2010-6-1&#39;, returnType =&#39;s&#39;)</span>
<span class="sd">                   {24: &#39;20100531&#39;,</span>
<span class="sd">                    48: &#39;20100530&#39;,</span>
<span class="sd">                    72: &#39;20100529&#39;,</span>
<span class="sd">                    96: &#39;20100528&#39;,</span>
<span class="sd">                   120: &#39;20100527&#39;,</span>
<span class="sd">                   144: &#39;20100526&#39;,</span>
<span class="sd">                   168: &#39;20100525&#39;}</span>

<span class="sd">              .. note:: Depends upon the availability of the fcst and anl</span>
<span class="sd">                        files, it should return partner date</span>

<span class="sd">           example 3 :</span>
<span class="sd">              &gt;&gt;&gt; findPartners(&#39;a&#39;,&#39;20100601&#39;,144)</span>
<span class="sd">                  2010-5-26 0:0:0.0</span>

<span class="sd">              .. seealso:: If not available for the passed hour means</span>
<span class="sd">                          it should return None</span>

<span class="sd">        Written by : Arulalan.T</span>

<span class="sd">        Date : 03.04.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">))</span> <span class="o">==</span> <span class="s">&quot;&lt;type &#39;comptime&#39;&gt;&quot;</span><span class="p">:</span>
            <span class="n">datecomp</span> <span class="o">=</span> <span class="n">date</span>

        <span class="k">elif</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c">#convert cdtime string into comptime</span>
            <span class="n">datecomp</span> <span class="o">=</span> <span class="n">cdtime</span><span class="o">.</span><span class="n">s2c</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymdpattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
            <span class="c"># conver from yyymmddhh into comptime</span>
            <span class="n">datecomp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribInputStringError</span><span class="p">(</span><span class="s">&quot;The passed date should be the </span><span class="se">\</span>
<span class="s">                            cdtime.comptime formate or its str formate &quot;</span><span class="p">)</span>
        <span class="c"># getting component time properties</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">datecomp</span><span class="o">.</span><span class="n">year</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">datecomp</span><span class="o">.</span><span class="n">month</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">datecomp</span><span class="o">.</span><span class="n">day</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="s">&#39;fcst&#39;</span><span class="p">]:</span>
            <span class="c"># fcst arg passed</span>
            <span class="k">if</span> <span class="n">hour</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;you must pass hour to find out the </span><span class="se">\</span>
<span class="s">                                    forecast partner date&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">hour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="p">:</span>
                <span class="n">partner_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;the passed </span><span class="si">%d</span><span class="s"> hour not match with keys</span><span class="se">\</span>
<span class="s">                                         of forecastdays dict &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span>

            <span class="c"># calling the TimeUtility&#39;s method moveTime to find out</span>
            <span class="c"># the partner&#39;s day</span>
            <span class="n">truth_anl_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">partner_day</span><span class="p">,</span>
                                           <span class="n">returnType</span> <span class="o">=</span> <span class="n">returnType</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">truth_anl_day</span>

        <span class="k">if</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;anl&#39;</span><span class="p">,</span> <span class="s">&#39;analysis&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="s">&#39;reference&#39;</span><span class="p">,</span>
                                                <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;obs&#39;</span><span class="p">,</span> <span class="s">&#39;obeservation&#39;</span><span class="p">]:</span>
            <span class="c"># anl arg passed or rainfall arg passed</span>
            <span class="k">if</span> <span class="n">hour</span><span class="p">:</span>
                <span class="c"># hour is not None</span>
                <span class="c"># finding the partner day by passing the arg as partner hour</span>
                <span class="k">if</span> <span class="n">hour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="p">:</span>
                    <span class="n">partner_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_GribInputError</span><span class="p">(</span><span class="s">&quot;the passed </span><span class="si">%d</span><span class="s"> hour not match with</span><span class="se">\</span>
<span class="s">                                        keys of forecastdays dict &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span>

                <span class="c"># to find the previous day, passing the -ve sign to the</span>
                <span class="c"># TimeUtility&#39;s moveTime method</span>
                <span class="n">previous_fcst_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span>
                                <span class="n">partner_day</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">returnType</span> <span class="o">=</span> <span class="n">returnType</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">previous_fcst_day</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># hour is none. i.e. need to extract all the fcst hours</span>
                <span class="n">fcst_hours_vs_date</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c"># loop throughing all the partner days and hours accordingly</span>
                <span class="k">for</span> <span class="n">partner_hour</span><span class="p">,</span> <span class="n">partner_day</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c"># To find the availability of the fcst hour xml file,</span>
                    <span class="c"># we call _getXmlAccessObj. If passed hour is not</span>
                    <span class="c"># available means it should return None                    </span>
                    <span class="c">#if partner_hour and self._getXmlAccessObj(&#39;f&#39;, partner_hour):</span>
                        <span class="c"># commented the above line to check the fcst hour file </span>
                        <span class="c"># is exist or not, for the generic functionality purpose.</span>
                        <span class="c"># to find the previous day, passing the -ve sign to</span>
                        <span class="c"># the TimeUtility&#39;s moveTime method</span>
                        <span class="n">previous_fcst_day</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span>
                                    <span class="n">partner_day</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">returnType</span> <span class="o">=</span><span class="n">returnType</span><span class="p">)</span>
                        <span class="c"># adding to the temporary dictionay</span>
                        <span class="n">fcst_hours_vs_date</span><span class="p">[</span><span class="n">partner_hour</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_fcst_day</span>
                <span class="c"># end of for ...:</span>
                <span class="k">return</span> <span class="n">fcst_hours_vs_date</span>
        <span class="c"># end of if Type in [&#39;a&#39;,&#39;A&#39;,&#39;r&#39;,&#39;R&#39;]:</span>
    <span class="c"># end of def findPartners(...):</span>
</div>
    <span class="k">def</span> <span class="nf">_getDataOfPartners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span> \
                                                             <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _getDataOfPartners : It can extract the data_of_partners.</span>
<span class="sd">        i.e it returns the partners data not along with its source Type data.</span>
<span class="sd">        It extracts the multiple data (depends upon the level,partners and</span>
<span class="sd">                                 dates) and returns in single MV2 variable.</span>

<span class="sd">        Condition :</span>
<span class="sd">          level is optional. level takes default &#39;all&#39;. if level passed,</span>
<span class="sd">          it must be belongs to the data variable.</span>
<span class="sd">          hour is must when Type arg should be &#39;f&#39; (fcst).</span>
<span class="sd">          Pass either (lat,lon) or region.</span>

<span class="sd">        Inputs:</span>
<span class="sd">           Type - either &#39;a&#39; or &#39;f&#39; or &#39;r&#39; or &#39;o&#39;</span>
<span class="sd">           var,level must be belongs to the data</span>
<span class="sd">           startdate and enddate must be in cdtime.comp string formate.</span>
<span class="sd">           skipdays must be an integer</span>
<span class="sd">           key word arg lat,lon or region should be passed</span>

<span class="sd">        Outputs:</span>
<span class="sd">              It should return the partners data as single MV2 variable in</span>
<span class="sd">              shape of (time,level,lat,lon). i.e with time axis,level axis,</span>
<span class="sd">              lat axis and lon axis.</span>
<span class="sd">              If level has squeezed while extract the data,</span>
<span class="sd">              then it should return only shape of (time,lat,lon).</span>

<span class="sd">        Usage:</span>

<span class="sd">           example 1:</span>
<span class="sd">             _getDataOfPartners(var = &quot;Geopotential Height&quot;,Type = &#39;f&#39;,</span>
<span class="sd">               date = &#39;2010-5-25&#39;, hour = 24,level = &#39;all&#39; ,region = AIR )</span>
<span class="sd">               #lat=(-90,90),lon=(0,359.5)</span>

<span class="sd">        Refer :</span>
<span class="sd">            method findPartners(...) of class TimeUtility:</span>

<span class="sd">        Written by: Arulalan.T</span>

<span class="sd">        Date: 09.04.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># have to enable this...</span>
        <span class="c"># self.checking_major_parameter_to_extract_data(Type,date,hour)</span>
        <span class="n">datavariables</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">partner_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPartners</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner_date</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c"># multiple dates</span>
            <span class="n">partner_hours</span> <span class="o">=</span> <span class="n">partner_date</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">partner_hours</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">partner_hours</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">partner_date</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span>
                                        <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
                <span class="n">variable</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
                <span class="c"># squeezing MV2 variable</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span><span class="p">(</span><span class="n">squeeze</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">datavariables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># single date</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">partner_date</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span>
                                             <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
            <span class="c"># squeezing MV2 variable</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span><span class="p">(</span><span class="n">squeeze</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">partner_date</span>
            <span class="n">datavariables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

        <span class="c"># get the start date from the datavariables</span>
        <span class="n">startdate</span> <span class="o">=</span> <span class="n">datavariables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span>
        <span class="c"># create the time axis in -ve. i.e. Backward days</span>
        <span class="n">timeAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generateTimeAxis</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datavariables</span><span class="p">),</span> <span class="n">startdate</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># get the level,lat,lon axis information</span>
        <span class="n">levelAxis</span> <span class="o">=</span> <span class="n">datavariables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLevel</span><span class="p">()</span>
        <span class="n">latAxis</span> <span class="o">=</span> <span class="n">datavariables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">()</span>
        <span class="n">lonAxis</span> <span class="o">=</span> <span class="n">datavariables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">levelAxis</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># shape (time,lat,lon)</span>
            <span class="n">VAR</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">datavariables</span><span class="p">,</span>
                                       <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">timeAxis</span><span class="p">,</span> <span class="n">latAxis</span><span class="p">,</span> <span class="n">lonAxis</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># shape (time,level,lat,lon)</span>
            <span class="n">VAR</span> <span class="o">=</span> <span class="n">cdms2</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">datavariables</span><span class="p">,</span>
                              <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">timeAxis</span><span class="p">,</span> <span class="n">levelAxis</span><span class="p">,</span> <span class="n">latAxis</span><span class="p">,</span> <span class="n">lonAxis</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">VAR</span>
    <span class="c"># end of def _getDataOfPartners(...):</span>

<div class="viewcode-block" id="GribXmlAccess.getData"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getData`: It can extract either the data of a single date or</span>
<span class="sd">             range of dates. It depends up on the input of the date argument.</span>
<span class="sd">             Finally it should return MV2 variable.</span>

<span class="sd">        Condition :</span>
<span class="sd">            date is either tuple or string.</span>
<span class="sd">            level is optional. level takes default &#39;all&#39;.</span>
<span class="sd">            if level passed, it must be belongs to the data variable</span>
<span class="sd">            hour is must when Type arg should be &#39;f&#39; (fcst) to choose</span>
<span class="sd">            xml object.</span>
<span class="sd">            Pass either (lat,lon) or region.</span>

<span class="sd">        Inputs :</span>
<span class="sd">          Type - either &#39;a&#39;[analysis] or &#39;f&#39;[forecast] or &#39;o&#39;[observation]</span>
<span class="sd">          var,level must be belongs to the data file</span>
<span class="sd">          key word arg lat,lon or region should be passed</span>
<span class="sd">          date formate must one of the followings</span>

<span class="sd">          date formate 1:</span>
<span class="sd">              date = (startdate, enddate)</span>
<span class="sd">              here startdate and enddate must be like cdtime.comptime formate.</span>

<span class="sd">          date formate 2:</span>
<span class="sd">               date = (startdate)</span>

<span class="sd">          date formate 3:</span>
<span class="sd">               date = &#39;startdate&#39; or date = &#39;date&#39;</span>

<span class="sd">          eg for date input :</span>
<span class="sd">               date = (&#39;2010-5-1&#39;,&#39;2010-6-30&#39;)</span>
<span class="sd">               date = (&#39;2010-5-30&#39;)</span>
<span class="sd">               date = &#39;2010-5-30&#39;</span>

<span class="sd">         Outputs :</span>

<span class="sd">               If user passed single date in the date argument, then it should</span>
<span class="sd">               return the data of that particular date as single MV2 variable.</span>

<span class="sd">               If user passed start and enddate in the date argument,</span>
<span class="sd">               then it should return the data for the range of dates as</span>
<span class="sd">               single MV2 variable with time axis.</span>

<span class="sd">        Written by: Arulalan.T</span>

<span class="sd">        Date: 10.05.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xmlobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getXmlAccessObj</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">xmlobj</span><span class="o">.</span><span class="n">getXmlData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="c"># end of def getData(...):</span>
</div>
<div class="viewcode-block" id="GribXmlAccess.getDataPartners"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.getDataPartners">[docs]</a>    <span class="k">def</span> <span class="nf">getDataPartners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span>
                        <span class="n">orginData</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">datePriority</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getDataPartners`: It can extract either the orginDate with its</span>
<span class="sd">        partnersData or it can extract only the partnersData without its</span>
<span class="sd">        orginData for a single date or range of dates.</span>

<span class="sd">        It depends up on the input of the orginData, datePriority,date args.</span>
<span class="sd">        Finally it should return partnersData and/or orginData as MV2 variable</span>

<span class="sd">        Condition :</span>

<span class="sd">         date is either tuple or string.</span>
<span class="sd">         level is optional. level takes default &#39;all&#39;.</span>
<span class="sd">         if level passed, it must be belongs to the data variable</span>
<span class="sd">         hour is must when Type arg should be &#39;f&#39; (fcst) to select xml object.</span>
<span class="sd">         hour is must when range of date passed, even thogut Type arg should</span>
<span class="sd">         be &#39;a&#39;(anl) or &#39;o&#39;(obs),to choose one fcst xml object along with hour.</span>
<span class="sd">         Pass either (lat,lon) or regionself.</span>

<span class="sd">        Inputs:</span>

<span class="sd">           Type - either &#39;a&#39;[analysis] or &#39;f&#39;[forecast] or &#39;o&#39;[observation]</span>
<span class="sd">           var,level must be belongs to the data file</span>
<span class="sd">           orginData - either 0 or 1. 0 means it shouldnot return the</span>
<span class="sd">                       orginData as single MV2 var.</span>
<span class="sd">                          1 means it should return both the orginData and its</span>
<span class="sd">                          partnersData as two seperate MV2 vars.</span>
<span class="sd">           datePriority - either &#39;o&#39; or &#39;p&#39;. &#39;o&#39; means passed date is with</span>
<span class="sd">                          respect to orginData. According to this</span>
<span class="sd">                          orginData&#39;s date, it should return its partnersData.</span>
<span class="sd">                        &#39;p&#39; means passed date is with respect to partnersData.</span>
<span class="sd">                            According to this partnersData&#39;s date, it should</span>
<span class="sd">                            return its orginData.</span>

<span class="sd">           key word arg lat,lon or region should be passed</span>

<span class="sd">           date formate 1:</span>
<span class="sd">              date = (startdate,enddate)</span>
<span class="sd">              here startdate and enddate must be like cdtime.comptime formate.</span>

<span class="sd">           date formate 2:</span>
<span class="sd">               date = (startdate)</span>

<span class="sd">           date formate 3:</span>
<span class="sd">               date = &#39;startdate&#39; or date = &#39;date&#39;</span>

<span class="sd">           eg for date input :</span>
<span class="sd">                  date = (&#39;2010-5-1&#39;,&#39;2010-6-30&#39;)</span>
<span class="sd">                   date = (&#39;2010-5-30&#39;)</span>
<span class="sd">                   date = &#39;2010-5-30&#39;</span>

<span class="sd">        Outputs:</span>

<span class="sd">           If user passed single date in the date argument, then it should</span>
<span class="sd">           return the data of that particular date</span>
<span class="sd">           (both orginData &amp; partnersData) as a single MV2 variable.</span>

<span class="sd">           If user passed start and enddate in the date argument, then it</span>
<span class="sd">           should return the data (both orginData &amp; partnersData)</span>
<span class="sd">           for the range of dates as a single MV2 variable with time axis.</span>


<span class="sd">        Usage:</span>

<span class="sd">           .. note::  if &#39;a&#39;(anl) file is orginData means &#39;f&#39;(fcst) files are</span>
<span class="sd">                   its partnersData and vice versa.</span>

<span class="sd">           example1:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getDataPartners(var = &#39;U component of wind&#39;,Type = &#39;a&#39;,</span>
<span class="sd">                    date = &#39;2010-6-5&#39;,hour = None,level = &#39;all&#39;,orginData = 1,</span>
<span class="sd">                    datePriority = &#39;o&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             a is orginData. i.e. anl. its timeAxis date is &#39;2010-6-5&#39;.</span>
<span class="sd">             b is partnersData. i.e. fcst. its 24 hour fcst date w.r.t</span>
<span class="sd">             orginData is &#39;2010-6-4&#39;. 48 hour is &#39;2010-6-3&#39;.</span>

<span class="sd">             Depends upon the availability of date of fcst files,it should</span>
<span class="sd">             return the data.</span>
<span class="sd">             In NCMRWF2010 model, it should return maximum of 7 days fcst.</span>

<span class="sd">             If we will specify any hour in the same eg, that should return</span>
<span class="sd">             only that hour fcst file data instead of returning all the</span>
<span class="sd">             available fcst hours data.</span>

<span class="sd">           example2:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getDataPartners(var = &#39;U component of wind&#39;,Type = &#39;f&#39;,</span>
<span class="sd">                      date = &#39;2010-6-5&#39;,hour = 24,level = &#39;all&#39;,orginData = 1,</span>
<span class="sd">                      datePriority = &#39;o&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             a is orginData. i.e.fcst 24 hour.its timeAxis date is &#39;2010-6-5&#39;.</span>
<span class="sd">             b is partnersData. i.e. anl. its anl date w.r.t orginData is</span>
<span class="sd">             &#39;2010-6-6&#39;.</span>

<span class="sd">           example3:</span>
<span class="sd">             &gt;&gt;&gt; b = getDataPartners(var = &#39;U component of wind&#39;,Type = &#39;f&#39;,</span>
<span class="sd">                     date = &#39;2010-6-5&#39;,hour = 24,level = &#39;all&#39;, orginData = 0,</span>
<span class="sd">                     datePriority = &#39;o&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             b is partnersData. i.e. anl. its anl date w.r.t orginData is</span>
<span class="sd">             &#39;2010-6-6&#39;. No orginData. Because we passed orginData as 0.</span>

<span class="sd">           example4:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getDataPartners(var = &#39;U component of wind&#39;,Type = &#39;f&#39;,</span>
<span class="sd">                      date = &#39;2010-6-5&#39;,hour = 24,level = &#39;all&#39;,orginData = 1,</span>
<span class="sd">                      datePriority = &#39;p&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             a is orginData. i.e. fcst 24 hour.its timeAxis date is &#39;2010-6-6&#39;.</span>
<span class="sd">             b is partnersData. i.e. anl. its anl date w.r.t orginData is</span>
<span class="sd">             &#39;2010-6-5&#39;.</span>
<span class="sd">             we can compare this eg4 with eg2. In this we passed datePriority</span>
<span class="sd">             as &#39;p&#39;. So the passed date as set to the partnersData and</span>
<span class="sd">             orginData&#39;s date has shifted to the next day.</span>

<span class="sd">           example5:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getDataPartners(var = &#39;U component of wind&#39;,Type = &#39;a&#39;,</span>
<span class="sd">                      date = (&#39;2010-6-5&#39;,&#39;2010-6-6&#39;),hour = 24,level = &#39;all&#39;,</span>
<span class="sd">                 orginData = 1,datePriority = &#39;o&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">                 .. note:: Even though we passed &#39;a&#39; Type, we must choose the</span>
<span class="sd">                           hour option to select the fcst file, since we are</span>
<span class="sd">                           passing the range of dates.</span>

<span class="sd">             a is orginData. i.e. anl. its timeAxis size is 2.</span>
<span class="sd">              date are &#39;2010-6-5&#39; and &#39;2010-6-6&#39;.</span>

<span class="sd">             b is partnersData. i.e. fcst 24 hour data.</span>
<span class="sd">             its timeAxis size is 2. date w.r.t orginData are &#39;2010-6-4&#39; and</span>
<span class="sd">             &#39;2010-6-5&#39;.</span>

<span class="sd">             a&#39;s &#39;2010-6-5&#39; has partner is b&#39;s &#39;2010-6-4&#39;.i.e.orginData(anl)</span>
<span class="sd">             partners is partnersData&#39;s (fcst).</span>

<span class="sd">             same concept for the remains day.</span>
<span class="sd">             a&#39;s &#39;2010-6-6&#39; has partner is b&#39;s &#39;2010-6-5&#39;.</span>

<span class="sd">           example6:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getDataPartners(var = &#39;U component of wind&#39;,Type = &#39;a&#39;,</span>
<span class="sd">                       date = (&#39;2010-6-5&#39;,&#39;2010-6-6&#39;),hour = 24,level = &#39;all&#39;,</span>
<span class="sd">                 orginData = 1,datePriority = &#39;p&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">                 .. note:: Even though we passed &#39;a&#39; Type, we must choose the</span>
<span class="sd">                           hour option to select the fcst file, since we are</span>
<span class="sd">                           passing the range of dates.</span>

<span class="sd">             a is orginData. i.e. anl. its timeAxis size is 2.</span>
<span class="sd">             date are &#39;2010-6-6&#39; and &#39;2010-6-7&#39;.</span>

<span class="sd">             b is partnersData. i.e. fcst 24 hour data.</span>
<span class="sd">             its timeAxis size is 2. date w.r.t orginData are &#39;2010-6-5&#39; and</span>
<span class="sd">             &#39;2010-6-6&#39;.</span>

<span class="sd">             a&#39;s &#39;2010-6-6&#39; has partner is b&#39;s &#39;2010-6-5&#39;.i.e.orginData(anl)</span>
<span class="sd">             partners is partnersData&#39;s (fcst).</span>

<span class="sd">             same concept for the remains day.</span>
<span class="sd">             a&#39;s &#39;2010-6-7&#39; has partner is b&#39;s &#39;2010-6-6&#39;.</span>
<span class="sd">             we can compare this eg6 with eg5.In this we passed datePriority</span>
<span class="sd">             as &#39;p&#39;. So the passed date as set to the partnersData and</span>
<span class="sd">             orginData&#39;s date has shifted towards the next days.</span>

<span class="sd">        Written by: Arulalan.T</span>

<span class="sd">        Date: 27.05.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orgin_enddate</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># assign startdate</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">orgin_enddate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c"># assign enddate</span>
            <span class="c"># end of if len(date) &gt;= 2:</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">))</span> <span class="o">==</span> <span class="s">&quot;&lt;type &#39;comptime&#39;&gt;&quot;</span><span class="p">:</span>
            <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="n">date</span> <span class="c"># assign date</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribAccessTypeError</span><span class="p">(</span><span class="s">&#39;date either must be tuple or string</span><span class="se">\</span>
<span class="s">                                           or cdtime.component time object&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>

        <span class="n">xdrange</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">orgin_enddate</span><span class="p">:</span>
            <span class="n">xdrange</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c"># enddate has passed. so we need hour to get the partners data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hour</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribAccessError</span><span class="p">(</span><span class="s">&#39;You must pass the hour to return the </span><span class="se">\</span>
<span class="s">                                        partners data,since you passed the </span><span class="se">\</span>
<span class="s">                                        enddate. i.e range of date.&#39;</span><span class="p">)</span>

        <span class="c"># end of if endCompTime:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">orginData</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">_GribAccessTypeError</span><span class="p">(</span><span class="s">&#39;orginData either 0 or 1.  </span><span class="se">\</span>
<span class="s">                        0 means without orginData. i.e. only partners data. </span><span class="se">\</span>
<span class="s">                          1 means with orginData. i.e. both orginData </span><span class="se">\</span>
<span class="s">                          and partnersData. Default it takes 0.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datePriority</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">_GribAccessTypeError</span><span class="p">(</span><span class="s">&quot;datePriority either &#39;o&#39; or &#39;p&#39;. </span><span class="se">\</span>
<span class="s">                             &#39;o&#39; means passed date set to the orginData. </span><span class="se">\</span>
<span class="s">                             &#39;p&#39; means passed date set to the partnersData.&quot;</span><span class="p">)</span>

        <span class="c"># find out the partners startdate</span>
        <span class="n">partner_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPartners</span><span class="p">(</span><span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="p">,</span>
                                    <span class="n">date</span> <span class="o">=</span> <span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xdrange</span><span class="p">:</span>
            <span class="c"># enddate passed</span>
            <span class="c"># find out the partners enddate</span>
            <span class="n">partner_enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPartners</span><span class="p">(</span><span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="p">,</span>
                                    <span class="n">date</span> <span class="o">=</span> <span class="n">orgin_enddate</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">datePriority</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span> <span class="ow">and</span> <span class="n">orginData</span><span class="p">:</span>
                <span class="c"># swaping the orgin date and partners date</span>
                <span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">partner_startdate</span> <span class="o">=</span> <span class="n">partner_startdate</span><span class="p">,</span> <span class="n">orgin_startdate</span>
                <span class="n">orgin_enddate</span><span class="p">,</span> <span class="n">partner_enddate</span> <span class="o">=</span> <span class="n">partner_enddate</span><span class="p">,</span> <span class="n">orgin_enddate</span>

                <span class="c"># orginData is 1</span>
                <span class="c"># make date into comptime object</span>
                <span class="n">partner_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">partner_startdate</span><span class="p">)</span>
                <span class="n">partner_enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">partner_enddate</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">hour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="p">:</span>
                    <span class="n">movedays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_GribAccessError</span><span class="p">(</span><span class="s">&quot;wrong </span><span class="si">%d</span><span class="s"> hour has passed as </span><span class="se">\</span>
<span class="s">                        arg, its not belongs to fcst grib file hours</span><span class="se">\n</span><span class="s"> </span><span class="se">\</span>
<span class="s">                                        Choose correct hour</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hour</span><span class="p">))</span>

                <span class="c"># find out the orgin startdate and enddate</span>
                <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">partner_startdate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                                <span class="n">partner_startdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                        <span class="n">partner_startdate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">movedays</span><span class="p">)</span>
                <span class="n">orgin_enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">partner_enddate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                                <span class="n">partner_enddate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                        <span class="n">partner_enddate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">movedays</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">datePriority</span> <span class="o">==</span> <span class="s">&#39;o&#39;</span><span class="p">:</span>
                <span class="c"># default behaviour. so no need to do any actions</span>
                <span class="k">pass</span>


            <span class="k">if</span> <span class="n">orginData</span><span class="p">:</span>
                <span class="c"># orginData is 1</span>
                <span class="c"># get the orgin data with respect to orgin_startdate</span>
                <span class="c"># and orgin_enddate</span>
                <span class="n">orgin_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">orgin_enddate</span><span class="p">)</span>
                <span class="n">orgin_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">orgin_time</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span>
                                                <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
            <span class="c"># end of if orginData:</span>

            <span class="c"># get the orgin&#39;s parnter data with respect to partner_startdate</span>
            <span class="c"># and partner_enddate</span>
            <span class="n">partner_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">partner_startdate</span><span class="p">,</span> <span class="n">partner_enddate</span><span class="p">)</span>
            <span class="n">partner_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">partner_time</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span>
                                                <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># end date doesnt passed</span>
            <span class="c"># actions for single date</span>

            <span class="k">if</span> <span class="n">datePriority</span> <span class="o">==</span> <span class="s">&#39;o&#39;</span><span class="p">:</span>
                <span class="c"># default behaviour. so no need to do any actions</span>
                <span class="c"># calling single date method to extract the data</span>
                <span class="k">if</span> <span class="n">orginData</span><span class="p">:</span>
                    <span class="c"># orginData is 1</span>
                    <span class="c"># get the orgin data with respect to orgin_startdate</span>
                    <span class="n">orgin_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">orgin_startdate</span><span class="p">,</span>
                                              <span class="n">hour</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
                <span class="c"># end of if orginData:</span>

                <span class="c"># get the partner data with respect to orgin_startdate.</span>
                <span class="c"># _getDataOfPartners will find its partner_date</span>
                <span class="n">partner_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDataOfPartners</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span>
                             <span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">datePriority</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">hour</span><span class="p">:</span>
                    <span class="c"># hour is not None</span>
                    <span class="c"># swaping the orgin date and partners date</span>
                    <span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">partner_startdate</span> <span class="o">=</span> <span class="n">partner_startdate</span><span class="p">,</span> <span class="n">orgin_startdate</span>

                    <span class="k">if</span> <span class="n">orginData</span><span class="p">:</span>
                        <span class="c"># orginData is 1</span>
                        <span class="c"># make date into comptime object</span>
                        <span class="n">partner_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestr2comp</span><span class="p">(</span><span class="n">partner_startdate</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">hour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="p">:</span>
                            <span class="n">movedays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">_GribAccessError</span><span class="p">(</span><span class="s">&quot;wrong </span><span class="si">%d</span><span class="s"> hour has passed</span><span class="se">\</span>
<span class="s">                             as arg, its not belongs to fcst grib file hours</span><span class="se">\</span>
<span class="s">                                        Choose correct hour</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hour</span><span class="p">))</span>

                        <span class="c"># find out the orgin startdate</span>
                        <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">partner_startdate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                                    <span class="n">partner_startdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                            <span class="n">partner_startdate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">movedays</span><span class="p">)</span>

                        <span class="c"># get the orgin data with respect to orgin_startdate</span>
                        <span class="n">orgin_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">orgin_startdate</span><span class="p">,</span>
                                                <span class="n">hour</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
                    <span class="c"># end of if orginData:</span>

                    <span class="c"># get the orgin&#39;s partner data with respect to</span>
                    <span class="c"># partner_startdate</span>
                    <span class="n">partner_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">partner_startdate</span><span class="p">,</span>
                                                <span class="n">hour</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># hour is None</span>
                    <span class="k">raise</span> <span class="n">_GribAccessError</span><span class="p">(</span><span class="s">&quot;you must pass the hour to choose </span><span class="se">\</span>
<span class="s">                    the partners, since you have set datePriority as &#39;p&#39; &quot;</span><span class="p">)</span>

            <span class="c"># end of if datePriority == &#39;o&#39;:</span>
        <span class="c"># end of if xdrange:</span>
        <span class="c"># Resetting the var id</span>
        <span class="n">partner_data</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">var</span>
        <span class="k">if</span> <span class="n">orginData</span><span class="p">:</span>
            <span class="c"># orginData is 1</span>
            <span class="k">return</span> <span class="n">orgin_data</span><span class="p">,</span> <span class="n">partner_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># orginData is 0</span>
            <span class="k">return</span> <span class="n">partner_data</span>
    <span class="c"># end of def getDataPartners(...)</span>
</div>
<div class="viewcode-block" id="GribXmlAccess.getRainfallData"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.getRainfallData">[docs]</a>    <span class="k">def</span> <span class="nf">getRainfallData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getRainfallData`: Extract the rainfall data from the xml file</span>
<span class="sd">                                 which has created by the cdscan command.</span>

<span class="sd">        Inputs : var takes from the instance member of GribAccess class</span>
<span class="sd">                if we passed date,level then it should return data accordingly</span>
<span class="sd">                 By default level takes &#39;all&#39; levels.</span>
<span class="sd">                 Pass either (lat,lon) or region keyword arg</span>

<span class="sd">        Condition : we must set the member variable called rainfallXmlPath</span>
<span class="sd">                    and (rainfallXmlVar or rainfallModel), then only we can</span>
<span class="sd">                    access this method. rainfallXmlVar is the obeservation</span>
<span class="sd">                    rainfall variable name to access the data. OR</span>
<span class="sd">                    rainfallModel is the model name, which has set in the</span>
<span class="sd">                    global variable names settings. By Using it, this method</span>
<span class="sd">                    should get the observation rainfall variable name.</span>

<span class="sd">        Written by : Arulalan.T</span>

<span class="sd">        Date : 29.05.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlPath</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_RainfallAccessError</span><span class="p">(</span><span class="s">&quot;You must set the rainfallXmlPath </span><span class="se">\</span>
<span class="s">                                      member of this GribAccess instance&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlVar</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rainfallModel</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">_RainfallAccessError</span><span class="p">(</span><span class="s">&quot;You must set the rainfallXmlVar </span><span class="se">\</span>
<span class="s">                     or rainfallModel member of this GribAccess instance&quot;</span><span class="p">)</span>
        <span class="c"># create normal XmlAccess object</span>
        <span class="n">rainXmlObj</span> <span class="o">=</span> <span class="n">XmlAccess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlPath</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlVar</span><span class="p">:</span>
            <span class="n">rainvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rainfallXmlVar</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">rainfallModel</span><span class="p">:</span>
            <span class="c"># get the observation rainvar name from the global vars settings</span>
            <span class="n">rainvar</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rainfallModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;rain&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">obs_var</span>

        <span class="c"># get the data accessing above object</span>
        <span class="n">rainfall_data</span> <span class="o">=</span> <span class="n">rainXmlObj</span><span class="o">.</span><span class="n">getXmlData</span><span class="p">(</span><span class="n">rainvar</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span>
                                                    <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rainfall_data</span>
    <span class="c"># end of def getRainfallData(...):</span>
</div>
<div class="viewcode-block" id="GribXmlAccess.getRainfallDataPartners"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.getRainfallDataPartners">[docs]</a>    <span class="k">def</span> <span class="nf">getRainfallDataPartners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">,</span>
                            <span class="n">orginData</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">datePriority</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getRainfallDataPartners`: It returns the rainfall data &amp; its</span>
<span class="sd">                     partners data(fcst is the partner of the observation.</span>
<span class="sd">                     i.e. rainfall) as MV2 vars</span>

<span class="sd">        Condition:</span>
<span class="sd">                  startdate is must. enddata is optional one.</span>
<span class="sd">                  If both startdate and enddate has passed means, it should</span>
<span class="sd">                  return the rainfall data and partnersData within that range.</span>

<span class="sd">        Inputs:</span>

<span class="sd">           orginData - either 0 or 1. 0 means it shouldnot return the</span>
<span class="sd">                       orginData as single MV2 var.</span>
<span class="sd">                          1 means it should return both the orginData and its</span>
<span class="sd">                          partnersData as two seperate MV2 vars.</span>

<span class="sd">           datePriority - either &#39;o&#39; or &#39;p&#39;. &#39;o&#39; means passed date is with</span>
<span class="sd">                        respect to orginData. According to this orginData&#39;s</span>
<span class="sd">                        date, it should return its partnersData.</span>
<span class="sd">                        &#39;p&#39; means passed date is with respect to partnersData.</span>
<span class="sd">                         According to this partnersData&#39;s date, it should</span>
<span class="sd">                         return its orginData.</span>

<span class="sd">           key word arg lat,lon or region should be passed</span>
<span class="sd">           By default hour is None and level is &#39;all&#39;.</span>

<span class="sd">           self.rainfallXmlPath is mandatory one when you choosed orginData</span>
<span class="sd">           is 1. you must set the rainfall xml path to the rainfallXmlPath.</span>

<span class="sd">           self.rainfallModel is the model name, which has set in the global</span>
<span class="sd">           variables settings, to get the model fcst and its obeservation</span>
<span class="sd">           variable name to access the data. It is mandatory one.</span>

<span class="sd">           date formate 1:</span>
<span class="sd">             date = (startdate,enddate)</span>
<span class="sd">             here startdate and enddate must be like cdtime.comptime formate.</span>

<span class="sd">           date formate 2:</span>
<span class="sd">               date = (startdate)</span>

<span class="sd">           date formate 3:</span>
<span class="sd">               date = &#39;startdate&#39; or date = &#39;date&#39;</span>

<span class="sd">           eg for date input :</span>
<span class="sd">               date = (&#39;2010-5-1&#39;,&#39;2010-6-30&#39;)</span>
<span class="sd">               date = (&#39;2010-5-30&#39;)</span>
<span class="sd">               date = &#39;2010-5-30&#39;</span>

<span class="sd">            By default skipdays as 1 takes place. User cant override till now.</span>

<span class="sd">        Outputs :</span>

<span class="sd">           If user passed single date in the date argument, then it should</span>
<span class="sd">           return the data of that particular date</span>
<span class="sd">           (both orginData &amp; partnersData) as MV2 variable.</span>

<span class="sd">           If user passed start and enddate in the date argument, then it</span>
<span class="sd">           should return the data (both orginData &amp; partnersData) for the</span>
<span class="sd">           range of dates as MV2 variable with time axis.</span>

<span class="sd">        Usage :</span>

<span class="sd">             .. note::  if &#39;r&#39;(observation) file is orginData means &#39;f&#39;(fcst)</span>
<span class="sd">                       files are its partnersData.</span>

<span class="sd">           example1:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getRainfallDataPartners(date = &#39;2010-6-5&#39;,hour = None,</span>
<span class="sd">                              level = &#39;all&#39;,orginData = 1,datePriority = &#39;o&#39;,</span>
<span class="sd">                                                  lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             a is orginData. i.e. rainfall observation.</span>
<span class="sd">             its timeAxis date is &#39;2010-6-5&#39;.</span>

<span class="sd">             b is partnersData. i.e. fcst. its 24 hour fcst date w.r.t</span>
<span class="sd">             orginData is &#39;2010-6-4&#39;. 48 hour is &#39;2010-6-3&#39;.</span>

<span class="sd">             Depends upon the availability of date of fcst files,it should</span>
<span class="sd">             return the data.</span>
<span class="sd">             In NCMRWF2010 model, it should return maximum of 7 days fcst.</span>

<span class="sd">             If we will specify any hour in the same eg, that should return</span>
<span class="sd">             only that hour fcst file data instead of returning all the</span>
<span class="sd">             available fcst hours data.</span>

<span class="sd">           example2:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getRainfallDataPartners(date = &#39;2010-6-5&#39;,hour = 24,</span>
<span class="sd">                              level = &#39;all&#39;,orginData = 1,datePriority = &#39;o&#39;,</span>
<span class="sd">                                                  lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             a is orginData. i.e. rainfall observation.</span>
<span class="sd">             its timeAxis date is &#39;2010-6-5&#39;.</span>
<span class="sd">             b is partnersData. i.e. fcst 24 hour. its fcst date w.r.t</span>
<span class="sd">             orginData is &#39;2010-6-6&#39;.</span>

<span class="sd">           example3:</span>
<span class="sd">             &gt;&gt;&gt; b = getRainfallDataPartners(date = &#39;2010-6-5&#39;,hour = 24,</span>
<span class="sd">                              level = &#39;all&#39;,orginData = 0,datePriority = &#39;o&#39;,</span>
<span class="sd">                                                  lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             b is partnersData. i.e. fcst. its fcst date w.r.t orginData</span>
<span class="sd">             is &#39;2010-6-6&#39;.  No orginData. Because we passed orginData as 0.</span>

<span class="sd">           example4:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getRainfallDataPartnerss(date = &#39;2010-6-5&#39;,hour = 24,</span>
<span class="sd">                              level = &#39;all&#39;,orginData = 1,datePriority = &#39;p&#39;,</span>
<span class="sd">                                                  lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">             a is orginData. i.e. rainfall observation.</span>
<span class="sd">             its timeAxis date is &#39;2010-6-6&#39;.</span>

<span class="sd">             b is partnersData. i.e. fcst 24 hour. its fcst date w.r.t</span>
<span class="sd">             orginData is &#39;2010-6-5&#39;.  we can compare this eg4 with eg2.</span>

<span class="sd">             In this we passed datePriority as &#39;p&#39;. So the passed date as</span>
<span class="sd">             set to the partnersData and orginData&#39;s date has shifted to</span>
<span class="sd">             the next day.</span>

<span class="sd">           example5:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getRainfallDataPartners(date = (&#39;2010-6-5&#39;,&#39;2010-6-6&#39;),</span>
<span class="sd">                                       hour = 24,level = &#39;all&#39;,orginData = 1,</span>
<span class="sd">                              datePriority = &#39;o&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">                  .. note:: We must choose the hour option to select the fcst</span>
<span class="sd">                           file, since we are passing the range of dates.</span>

<span class="sd">             a is orginData.i.e.rainfall observation.its timeAxis size is 2.</span>
<span class="sd">             date are &#39;2010-6-5&#39; and &#39;2010-6-6&#39;.</span>

<span class="sd">             b is partnersData.i.e.fcst 24 hour data.its timeAxis size is 2.</span>
<span class="sd">             date w.r.t orginData are &#39;2010-6-4&#39; and &#39;2010-6-5&#39;.</span>

<span class="sd">             a&#39;s &#39;2010-6-5&#39; has partner is b&#39;s &#39;2010-6-4&#39;. i.e.</span>
<span class="sd">             orginData(rainfall observation) partners is partnersData(fcst)</span>

<span class="sd">             same concept for the remains day.</span>
<span class="sd">             a&#39;s &#39;2010-6-6&#39; has partner is b&#39;s &#39;2010-6-5&#39;.</span>

<span class="sd">           example6:</span>
<span class="sd">             &gt;&gt;&gt; a,b = getRainfallDataPartners(date = (&#39;2010-6-5&#39;,&#39;2010-6-6&#39;),</span>
<span class="sd">                                      hour = 24,level = &#39;all&#39;,orginData = 1,</span>
<span class="sd">                              datePriority = &#39;p&#39;, lat=(-90,90),lon=(0,359.5))</span>

<span class="sd">                  .. note : We must choose the hour option to select the fcst</span>
<span class="sd">                            file, since we are passing the range of dates.</span>

<span class="sd">             a is orginData. i.e. rainfall observation.</span>
<span class="sd">             its timeAxis size is 2. date are &#39;2010-6-6&#39; and &#39;2010-6-7&#39;.</span>

<span class="sd">             b is partnersData. i.e. fcst 24 hour data.</span>
<span class="sd">             its timeAxis size is 2. date w.r.t orginData are &#39;2010-6-5&#39;</span>
<span class="sd">             and &#39;2010-6-6&#39;.</span>

<span class="sd">             a&#39;s &#39;2010-6-6&#39; has partner is b&#39;s &#39;2010-6-5&#39;. i.e.</span>
<span class="sd">             orginData(rainfall observation) partners is partnersData(fcst)</span>

<span class="sd">             same concept for the remains day.</span>
<span class="sd">             a&#39;s &#39;2010-6-7&#39; has partner is b&#39;s &#39;2010-6-6&#39;. we can compare</span>
<span class="sd">             this eg6 with eg5. In this we passed datePriority as &#39;p&#39;.</span>
<span class="sd">             So the passed date as set to the partnersData and orginData&#39;s</span>
<span class="sd">             date has shifted towards the next days.</span>

<span class="sd">        Written by: Arulalan.T</span>

<span class="sd">        Date: 29.05.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orgin_enddate</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># assign startdate</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">orgin_enddate</span> <span class="o">=</span> <span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c"># assign enddate</span>
            <span class="c"># end of if len(date) &gt;= 2:</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">))</span> <span class="o">==</span> <span class="s">&quot;&lt;type &#39;comptime&#39;&gt;&quot;</span><span class="p">:</span>
            <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="n">date</span> <span class="c"># assign date</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_GribAccessTypeError</span><span class="p">(</span><span class="s">&#39;date either must be tuple or string </span><span class="se">\</span>
<span class="s">                                           or cdtime.component time object&#39;</span><span class="p">)</span>
        <span class="c"># end of if isinstance(date,tuple):</span>

        <span class="k">if</span> <span class="n">orgin_enddate</span><span class="p">:</span>
            <span class="c"># enddate has passed. so we need hour to get the partners data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hour</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribAccessError</span><span class="p">(</span><span class="s">&#39;You must pass the hour to return the</span><span class="se">\</span>
<span class="s">             partners data,since you passed the enddate. i.e range of date.&#39;</span><span class="p">)</span>
        <span class="c"># end of if orgin_enddate:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">orginData</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">_GribAccessTypeError</span><span class="p">(</span><span class="s">&#39;orginData either 0 or 1.</span><span class="se">\</span>
<span class="s">              0 means without orginData. i.e. only partners data. </span><span class="se">\</span>
<span class="s">              1 means with orginData. i.e. both orginData and partnersData. </span><span class="se">\</span>
<span class="s">              Default it takes 0.&#39;</span><span class="p">)</span>
        <span class="c"># end of if not orginData in [0, 1]:</span>

        <span class="k">if</span> <span class="n">orginData</span><span class="p">:</span>
            <span class="c"># orginData is 1</span>
            <span class="k">if</span> <span class="n">datePriority</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">hour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="p">:</span>
                    <span class="n">movedays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forecastdays_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_GribAccessError</span><span class="p">(</span><span class="s">&quot;wrong </span><span class="si">%d</span><span class="s"> hour has passed as arg</span><span class="se">\</span>
<span class="s">                                  its not belongs to fcst grib file hours. </span><span class="se">\</span>
<span class="s">                                  Choose correct hour</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hour</span><span class="p">))</span>

                <span class="c">#</span>
                <span class="c"># Finding the Orgin&#39;s Shift startdate and enddate</span>
                <span class="c">#</span>

                <span class="c"># find out the partners startdate</span>
                <span class="n">partner_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPartners</span><span class="p">(</span><span class="n">Type</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span>
                                        <span class="n">date</span> <span class="o">=</span> <span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="p">)</span>
                <span class="c"># swaping the orgin date and partners date</span>
                <span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">partner_startdate</span> <span class="o">=</span> <span class="n">partner_startdate</span><span class="p">,</span> <span class="n">orgin_startdate</span>

                <span class="c"># find out the orgin startdate</span>
                <span class="n">orgin_startdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">partner_startdate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                        <span class="n">partner_startdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                        <span class="n">partner_startdate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">movedays</span><span class="p">)</span>
                <span class="c"># setting time to extract orginData with start date only</span>
                <span class="n">orgin_time</span> <span class="o">=</span> <span class="n">orgin_startdate</span>

                <span class="k">if</span> <span class="n">orgin_enddate</span><span class="p">:</span>
                    <span class="c"># find out the partners enddate for rainfall type</span>
                    <span class="n">partner_enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPartners</span><span class="p">(</span><span class="n">Type</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span>
                                            <span class="n">date</span> <span class="o">=</span> <span class="n">orgin_enddate</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="p">)</span>
                    <span class="c"># swaping the orgin date and partners date</span>
                    <span class="n">orgin_enddate</span><span class="p">,</span> <span class="n">partner_enddate</span> <span class="o">=</span> <span class="n">partner_enddate</span><span class="p">,</span> <span class="n">orgin_enddate</span>
                    <span class="c"># find out the orgin enddate</span>
                    <span class="n">orgin_enddate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveTime</span><span class="p">(</span><span class="n">partner_enddate</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                                <span class="n">partner_enddate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                                <span class="n">partner_enddate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">movedays</span><span class="p">)</span>
                    <span class="c"># setting time to extract orginData with startdate and</span>
                    <span class="c"># enddate</span>
                    <span class="n">orgin_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">orgin_enddate</span><span class="p">)</span>
                <span class="c"># end of if orgin_enddate:</span>

            <span class="k">elif</span> <span class="n">datePriority</span> <span class="o">==</span> <span class="s">&#39;o&#39;</span><span class="p">:</span>
                <span class="c"># default behaviour.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">orgin_enddate</span><span class="p">:</span>
                    <span class="c"># setting time to extract orginData with start date only</span>
                    <span class="n">orgin_time</span> <span class="o">=</span> <span class="n">orgin_startdate</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># setting time to extract orginData with startdate and</span>
                    <span class="c"># enddate</span>
                    <span class="n">orgin_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">orgin_startdate</span><span class="p">,</span> <span class="n">orgin_enddate</span><span class="p">)</span>
                <span class="c"># end of if not orgin_enddate:</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">_GribAccessTypeError</span><span class="p">(</span><span class="s">&quot;datePriority either &#39;o&#39; or &#39;p&#39;. </span><span class="se">\</span>
<span class="s">                                &#39;o&#39; means passed date set to the orginData.</span><span class="se">\</span>
<span class="s">                              &#39;p&#39; means passed date set to the partnersData&quot;</span><span class="p">)</span>

            <span class="c"># get the data accessing above object</span>
            <span class="n">rainfall_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRainfallData</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="n">orgin_time</span><span class="p">,</span>
                                                <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
        <span class="c"># end of if orginData:</span>
        <span class="c"># get the model fcst rainvar name from the global vars settings</span>
        <span class="n">fcstrainvar</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rainfallModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;rain&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">model_var</span>
        <span class="c">#</span>
        <span class="c"># Find and get the rainfall partners data</span>
        <span class="c">#</span>
        <span class="n">rainfall_partners_fcst_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataPartners</span><span class="p">(</span><span class="n">fcstrainvar</span><span class="p">,</span>
                          <span class="n">Type</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">date</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">,</span>
                          <span class="n">orginData</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">datePriority</span> <span class="o">=</span> <span class="n">datePriority</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
        <span class="c"># apcpsfc is a fcst var for total precipitation.i.e. rain in NCMR grib</span>
        <span class="c"># files</span>
        <span class="k">if</span> <span class="n">orginData</span><span class="p">:</span>
            <span class="c"># orginData is 1</span>
            <span class="k">return</span> <span class="n">rainfall_data</span><span class="p">,</span> <span class="n">rainfall_partners_fcst_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># orginData is 0</span>
            <span class="k">return</span> <span class="n">rainfall_partners_fcst_data</span>
    <span class="c"># end of def getRainfallDataPartners(...):</span>
</div>
<div class="viewcode-block" id="GribXmlAccess.getMonthAvgData"><a class="viewcode-back" href="../diagnosisutils.html#xml_data_access.GribXmlAccess.getMonthAvgData">[docs]</a>    <span class="k">def</span> <span class="nf">getMonthAvgData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span>
                        <span class="n">calendarName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :func:`getMonthAvgData`: It returns the average of the given month</span>
<span class="sd">                data (all days in the month) for the passed variable options</span>

<span class="sd">        Condition :</span>
<span class="sd">         calendarName,level are optional.</span>
<span class="sd">         level takes default &#39;all&#39; if not pass arg for it.</span>
<span class="sd">         hour is must when Type arg should be &#39;f&#39; (fcst) to select xml object.</span>
<span class="sd">         Pass either (lat,lon) or region.</span>

<span class="sd">        Inputs :</span>
<span class="sd">           Type - either &#39;a&#39; or &#39;f&#39; or &#39;o&#39;</span>
<span class="sd">           var,level must be belongs to the data file</span>
<span class="sd">           month may be even in 3 char like &#39;apr&#39; or &#39;April&#39; or &#39;aPRiL&#39; or</span>
<span class="sd">           like any month</span>
<span class="sd">           year must be passed as integer</span>
<span class="sd">           calendarName default None, it takes cdtime.DefaultCalendar</span>
<span class="sd">           key word arg lat,lon or region should be passed</span>

<span class="sd">        Outputs :</span>
<span class="sd">           It should return the average of the whole month data for the given</span>
<span class="sd">           vars as MV2 variable</span>

<span class="sd">        Usage :</span>

<span class="sd">           example :</span>
<span class="sd">             &gt;&gt;&gt; getMonthAvgData(var = &quot;Geopotential Height&quot;,Type = &#39;f&#39;,</span>
<span class="sd">                         level = &#39;all&#39;, month = &#39;july&#39;,year=2010 , hour = 24,</span>
<span class="sd">                          region = AIR ) #lat=(-90,90),lon=(0,359.5)</span>

<span class="sd">             returns dataAvg of one month data as single MV2 variable</span>

<span class="sd">        Written by: Arulalan.T</span>

<span class="sd">        Date: 29.04.2011</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># calling TimeUtility&#39;s method monthFirstLast to get the First Last</span>
        <span class="c"># dates of the passed month</span>
        <span class="n">monthFLDate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monthFirstLast</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">calendarName</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="n">var</span> <span class="o">=</span> <span class="n">var</span><span class="p">,</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Type</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">monthFLDate</span><span class="p">,</span>
                            <span class="n">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">latlonregion</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Taking average the data over the time axis.</span>
        <span class="c"># The averager will sum all the day data and divide by the no of days</span>
        <span class="c"># in the time axis. finally it should return the AVG data.</span>
        <span class="c">#</span>
        <span class="n">dataAvg</span> <span class="o">=</span> <span class="n">cdutil</span><span class="o">.</span><span class="n">averager</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataAvg</span>
    <span class="c"># end of def getMonthAvgData(...):</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">mmDiagnosis 1a documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Arulalan.T, Dr.Krishna AchutaRao, Dilipkumar.R.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>